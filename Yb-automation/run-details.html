<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard with Filters</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-900 text-white">
<div id="testRunDetailsHeader" class="border-b border-gray-200 bg-white px-4 py-5 sm:px-6">
  <!-- Test Details will be appended here -->
</div>
<div id="videoContainer" class="w-full h-1/2 flex items-center justify-center bg-gray-800 relative">
  <video src="video.mp4" controls class="w-full h-full"></video>
<div class="absolute bottom-0 left-0 right-0 p-4 flex justify-between">
    <button type="button" class="rounded-full bg-indigo-600 px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
      View Video Link
    </button>
    <button type="button" class="rounded-full bg-indigo-600 px-3.5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
      Download Video
    </button>
</div>
</div>
<h2 class="text-2xl font-bold mt-4 mb-2">Logs</h2>
<div id="logsContainer" class="w-full p-4 bg-white">
  <!-- Logs will be appended here -->
</div>
<h2 class="text-2xl font-bold mt-4 mb-2">Test Runs Report</h2>
<div class="mt-8 flow-root">
  <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
    <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
      <table class="min-w-full divide-y divide-gray-700">
        <thead>
          <tr>
            <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-white sm:pl-0">Run ID</th>
            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-white">Status</th>
            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-white">Last Run</th>
          </tr>
        </thead>
        <tbody id="test-runs-body" class="divide-y divide-gray-800">
        </tbody>
      </table>
    </div>
  </div>
</div>
<script>// Utility functions
const createElement = (type, text, classes) => {
    const element = document.createElement(type);
    element.textContent = text;
    element.className = classes;
    return element;
};

const createButton = (text, classes, onClick) => {
    const button = createElement('button', text, classes);
    button.addEventListener('click', onClick);
    return button;
};

// Fetching and displaying data
const fetchPreviousRuns = async () => {
    const { id, testName } = getParamsFromUrl();
    const url = "https://m3safcz3boalyw7x7dl4qig3wq0tucft.lambda-url.us-west-2.on.aws/";
    const data = { "testName": testName };
    const headers = { 'Content-type': 'application/json' };

    try {
        const response = await axios.post(url, data, { headers: headers });
        return response.data;
    } catch (error) {
        console.error('Error:', error);
        displayError('There was an error fetching the data. Please try again later.');
    }
};

const displayPreviousRuns = async () => {
    try {
        const previousRunsData = await fetchPreviousRuns();
        const testRunsBody = document.getElementById('test-runs-body');
        testRunsBody.innerHTML = '';

        previousRunsData.forEach(testRun => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="border px-4 py-2">${testRun.id}</td>
                <td class="border px-4 py-2">${testRun.status}</td>
                <td class="border px-4 py-2">${testRun.timestamp}</td>
            `;
            row.addEventListener('click', () => displayRunDetails(testRun.id, previousRunsData));
            testRunsBody.appendChild(row);
        });
    } catch (error) {
        console.error('Error:', error);
        displayError('There was an error displaying the data. Please try again later.');
    }
};

// Displaying run details
const displayRunDetails = (runId, previousRunsData) => {
    const testRunDetailsHeader = document.getElementById('testRunDetailsHeader');
    const logsContainer = document.getElementById('logsContainer');
    const testRun = previousRunsData.find(run => run.id === runId);

    if (testRun) {
        testRunDetailsHeader.innerHTML = '';

        const headerDiv = document.createElement('div');
        headerDiv.className = "-ml-4 -mt-2 flex flex-wrap items-center justify-between sm:flex-nowrap";

        const titleDiv = document.createElement('div');
        titleDiv.className = "ml-4 mt-2";
        const headerText = `${testRun.team} - ${testRun.formattedTestName} - ${testRun.status} - ${testRun.id}`;
        const header = createElement('h3', headerText, 'text-base font-semibold leading-6 text-gray-900');
        titleDiv.appendChild(header);

        const buttonDiv = document.createElement('div');
        buttonDiv.className = "ml-4 mt-2 flex-shrink-0";
        const viewCodeButton = createButton('View Code', 'relative inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600', () => {
            window.location.href = `viewCode.html?filePath=${encodeURIComponent(testRun.filePath)}`;
        });
        buttonDiv.appendChild(viewCodeButton);

        headerDiv.appendChild(titleDiv);
        headerDiv.appendChild(buttonDiv);
        testRunDetailsHeader.appendChild(headerDiv);

        const summary = createElement('h3', testRun.logsShortSummary, 'text-center text-lg mt-2');
        testRunDetailsHeader.appendChild(summary);
    }
};

const viewCodeButton = createButton('View Code', 'rounded-full bg-indigo-600 px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600', () => {
    window.location.href = `viewCode.html?filePath=${encodeURIComponent(testRun.filePath)}`;
});

// Getting URL parameters
const getParamsFromUrl = () => {
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    const testName = urlParams.get('testName');
    return { id, testName };
};

// Display error
const displayError = (message) => {
    const errorContainer = document.getElementById('errorContainer');
    errorContainer.textContent = message;
    errorContainer.style.display = 'block';
};

// Initial data fetch
displayPreviousRuns();
</script>
</body>
</html>
