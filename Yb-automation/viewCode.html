<!DOCTYPE html>
<html>
<head>
    <title>Extract testName</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-markup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-bash.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white">
<div class="flex space-x-1 rounded-xl bg-gray-800 p-1" id="tab-list">
    <!-- Code View Button -->
    <button id="viewCodeButton" class="tab-button w-full rounded-lg py-2.5 text-md font-medium leading-5 text-gray-400 hover:text-white focus:outline-none flex items-center justify-center" data-target="code">
        <!-- Code Icon -->
    </button>
    <!-- Logs View Button -->
    <button id="viewLogsButton" class="tab-button w-full rounded-lg py-2.5 text-md font-medium leading-5 text-gray-400 hover:text-white focus:outline-none flex items-center justify-center" data-target="logs">
        <!-- Logs Icon -->
    </button>
</div>
<!-- Code Box -->
<div class="flex-grow w-full overflow-auto flex flex-col hidden mb-16" id="viewCodeBox">
    <pre class="line-numbers pl-14 pt-0 pb-4 pr-4 min-h-screen"><code id="codeBox" class="language-python w-full text-lg leading-relaxed"></code></pre>
</div>
<!-- Logs Container -->
<div class="flex-grow w-full overflow-auto hidden mb-16" id="viewLogsContainer">
    <div id="standardOutput" class="language-bash"></div>
    <div id="standardError" class="language-bash text-red-500"></div>
</div>
<!-- User Request Container -->
<div id="userRequestContainer" class="fixed bottom-0 left-0 right-0 z-50 bg-gray-100 border-t border-gray-300 p-0.75 shadow-md">
    <div class="relative flex items-center border rounded-lg shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-indigo-600">
        <textarea name="userRequestInputBox" id="userRequestInputBox" class="block w-full resize-none border-none bg-transparent text-base sm:text-sm leading-6 placeholder:text-gray-400 focus:ring-0 rounded-l-lg p-2" placeholder="Enter your request here..." oninput="autoResizeTextarea(this)" style="height: 2.5rem;"></textarea>
        <button type="button" id="executePythonCodeButton" class="inline-flex items-center rounded-r-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-600">
            <!-- Play Icon -->
        </button>
    </div>
</div>

<script>
    function autoResizeTextarea(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    }

    function executeCode() {
        const urlParams = new URLSearchParams(window.location.search);
        const filePath = urlParams.get('testName');
        const executeButton = document.getElementById('executePythonCodeButton');
        const playIcon = executeButton.innerHTML;
        const spinnerIcon = '<div class="loader"></div>'; // Add your spinner icon HTML here
        executeButton.innerHTML = spinnerIcon;

        axios.post('https://xmichysgq4emm6orafcdnwwhwu0lvmez.lambda-url.us-west-2.on.aws/', {
            filePath: filePath
        })
        .then(function (response) {
            const output = response.data.StandardOutputContent || '';
            const error = response.data.StandardErrorContent || '';
            document.getElementById('standardOutput').textContent = output;
            document.getElementById('standardError').textContent = error;
            Prism.highlightAll();
            executeButton.innerHTML = playIcon;
            document.getElementById('viewLogsButton').click();
        })
        .catch(function (error) {
            console.error('Error executing code:', error);
            executeButton.innerHTML = playIcon;
        });
    }

    document.getElementById('executePythonCodeButton').addEventListener('click', executeCode);

    function toggleTab(selectedTab) {
        const tabs = document.querySelectorAll('.tab-button');
        tabs.forEach(tab => {
            if (tab === selectedTab) {
                tab.classList.add('text-white', 'bg-gray-600');
                tab.classList.remove('text-gray-400', 'hover:text-white', 'hover:bg-gray-400');
            } else {
                tab.classList.remove('text-white', 'bg-gray-600');
                tab.classList.add('text-gray-400', 'hover:text-white', 'hover:bg-gray-400');
            }
        });
    }

    document.getElementById('viewCodeButton').addEventListener('click', function() {
        toggleTab(this);
        document.getElementById('viewCodeBox').classList.remove('hidden');
        document.getElementById('viewLogsContainer').classList.add('hidden');
    });

    document.getElementById('viewLogsButton').addEventListener('click', function() {
        toggleTab(this);
        document.getElementById('viewLogsContainer').classList.remove('hidden');
        document.getElementById('viewCodeBox').classList.add('hidden');
    });

    window.onload = function() {
        document.getElementById('viewCodeButton').click();
    }
</script>
<style>
    .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
</body>
</html>
