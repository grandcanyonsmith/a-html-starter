<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <title>Change with AI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Include Scripts and Styles -->
    <!-- Axios CDN for AJAX requests (latest version) -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.5.0/dist/axios.min.js"></script>
    <!-- Tailwind CSS CDN (latest version) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind CSS Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'light-background': '#f9fafb',
                        'bold-text': '#1f2937',
                        'italic-text': '#4b5563',
                        'buttons': '#2563eb',
                        'button-text': '#ffffff',
                        'link-text': '#2563eb',
                        'icon-color': '#2563eb',
                        'button-hover': '#3b82f6',
                    },
                },
            },
        };
    </script>
</head>
<body>
    <!-- Fixed Buttons -->
    <div class="fixed bottom-4 right-4 flex space-x-2 z-50">
        <button id="changeWithAI" type="button" aria-label="Change with AI" class="flex items-center space-x-2 px-4 py-2 bg-buttons text-button-text text-sm font-medium rounded-md shadow-md hover:bg-button-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-buttons">
            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                <!-- Icon for AI -->
                <path d="M13 7H7v6h6V7zM9 9h2v2H9V9z M3 3h2v2H3V3z M15 3h2v2h-2V3z M3 15h2v2H3v-2z M15 15h2v2h-2v-2z M9 3h2v2H9V3z M9 15h2v2H9v-2z" />
            </svg>
            <span>Change with AI</span>
        </button>
        <button id="saveChanges" type="button" aria-label="Save changes" class="flex items-center space-x-2 px-4 py-2 bg-green-500 text-white text-sm font-medium rounded-md shadow-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                <!-- Icon for Save -->
                <path d="M17 3a1 1 0 00-1-1h-3.586a1 1 0 00-.707.293l-.707.707H9v2h2v2H9v2h2v2H9v2h2v2H9v2h2v2H3a1 1 0 100 2h14a1 1 0 001-1V3z"/>
            </svg>
            <span>Save</span>
        </button>
    </div>

    <!-- Modal -->
    <div id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded shadow-lg max-w-[90vw] w-[90%] mx-auto">
            <h2 id="modalTitle" class="text-lg font-bold mb-4">What would you like to change?</h2>
            <textarea id="userRequest" class="w-full p-2 border rounded mb-4" rows="4" aria-label="Describe what you would like to change"></textarea>
            <div class="flex justify-end">
                <button id="cancelButton" type="button" class="bg-gray-500 text-white px-4 py-2 rounded mr-2 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">Cancel</button>
                <button id="submitButton" type="button" class="bg-buttons text-button-text px-4 py-2 rounded hover:bg-button-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-buttons">Submit</button>
            </div>
        </div>
    </div>

    <!-- Header Section -->
    <header>
        <nav class="bg-light-background">
            <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 justify-between items-center">
                    <div class="flex flex-1 justify-center sm:justify-start">
                        <div class="flex-shrink-0 flex items-center">
                            <!-- Placeholder for logo -->
                            <div id="logo_url_placeholder" class="bg-gray-200 animate-pulse h-16 w-32 rounded"></div>
                            <img id="logo_url" class="custom-value-logo_url h-16 w-auto hidden" src="" alt="Company Logo" loading="lazy" height="64">
                        </div>
                    </div>
                    <div class="hidden sm:flex items-center">
                        <svg class="mr-2 h-6 w-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                            <path d="M2.94 4.94A1.5 1.5 0 014.5 4h11a1.5 1.5 0 011.56 1.44l-7.06 4.72a.5.5 0 01-.56 0L2.94 5.44zM2 6.5v7A1.5 1.5 0 003.5 15h13a1.5 1.5 0 001.5-1.5v-7l-7.06 4.72a2.5 2.5 0 01-2.88 0L2 6.5z" />
                        </svg>
                        <!-- Placeholder for email -->
                        <div id="location_owner_email_placeholder" class="bg-gray-200 animate-pulse h-4 w-32 rounded"></div>
                        <span id="location_owner_email" class="text-gray-900 text-sm font-medium hidden"></span>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="bg-light-background text-bold-text">
        <!-- Content -->
        <main class="mx-auto max-w-5xl py-24 sm:py-24 lg:py-24">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <!-- Text Content -->
                <section class="text-center lg:text-left">
                    <!-- Placeholder for headline -->
                    <p id="headline_to_establish_credibility_and_summarize_course_placeholder" class="bg-gray-200 animate-pulse h-4 w-1/2 mx-auto lg:mx-0 rounded"></p>
                    <p id="headline_to_establish_credibility_and_summarize_course" class="text-sm font-semibold tracking-wide custom-value-headline_to_establish_credibility_and_summarize_course hidden custom-value-clickable custom-value-hoverable"></p>

                    <!-- Placeholder for main heading -->
                    <div id="get_this_amazing_outcome_without_this_painful_thing_placeholder" class="mt-4 bg-gray-200 animate-pulse h-8 w-full rounded"></div>
                    <h1 id="get_this_amazing_outcome_without_this_painful_thing" class="mt-4 text-3xl font-bold tracking-tight sm:text-3xl lg:text-5xl custom-value-get_this_amazing_outcome_without_this_painful_thing hidden custom-value-clickable custom-value-hoverable"></h1>

                    <!-- Placeholder for description -->
                    <p id="what_you_will_learn_in_the_course_placeholder" class="mt-2 bg-gray-200 animate-pulse h-4 w-3/4 mx-auto lg:mx-0 rounded"></p>
                    <p id="what_you_will_learn_in_the_course" class="mt-2 text-base leading-8 custom-value-what_you_will_learn_in_the_course hidden custom-value-clickable custom-value-hoverable"></p>

                    <div class="mt-8 flex items-center justify-center lg:justify-start gap-x-6">
                        <a href="#" class="bg-blue-600 text-white px-5 py-3 rounded-md text-base font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-600">Get Instant Access Here!</a>
                    </div>
                </section>

                <!-- Video and Reviews -->
                <section class="flex flex-col items-center lg:items-start">
                    <div class="w-full">
                        <div class="bg-buttons text-button-text text-center py-2 font-semibold">CLICK BELOW TO WATCH FIRST!</div>
                        <div class="video-container bg-black">
                            <video controls muted poster="video-poster.webp" class="rounded-lg shadow-lg w-full" preload="none">
                                <source src="https://cc360-publicbucketszoomrecord.s3.us-west-2.amazonaws.com/CARD+REQUIRED+VERSION+2+(1).mp4" type="video/mp4">
                                <track kind="captions" src="captions.vtt" srclang="en" label="English">
                                <p>Your browser does not support the video tag. Here is a <a href="https://cc360-publicbucketszoomrecord.s3.us-west-2.amazonaws.com/CARD+REQUIRED+VERSION+2+(1).mp4">link to the video</a> instead.</p>
                            </video>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center">
                        <img class="h-10 w-10 rounded-full" src="https://randomuser.me/api/portraits/men/32.jpg" alt="John, satisfied customer" loading="lazy" width="40" height="40">
                        <img class="h-10 w-10 rounded-full -ml-2" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Emily, satisfied customer" loading="lazy" width="40" height="40">
                        <img class="h-10 w-10 rounded-full -ml-2" src="https://randomuser.me/api/portraits/men/45.jpg" alt="Michael, satisfied customer" loading="lazy" width="40" height="40">
                        <img class="h-10 w-10 rounded-full -ml-2" src="https://randomuser.me/api/portraits/women/46.jpg" alt="Sophia, satisfied customer" loading="lazy" width="40" height="40">
                        <div class="ml-4">
                            <p class="text-sm font-semibold text-gray-900">4.9/5 star reviews</p>
                            <p class="text-sm text-italic-text">Thousands of happy customers worldwide</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Section 3 -->
    <section id="section-3">
        <div class="bg-light-background py-2 sm:py-2">
            <div class="mx-auto max-w-7xl px-6 lg:px-8">
                <h2 id="as_seen_on_title" class="text-center text-lg font-semibold leading-8 text-link-text custom-value-as_seen_on_title custom-value-clickable custom-value-hoverable">
                    As seen on
                </h2>
                <div class="mx-auto mt-10 grid max-w-lg grid-cols-4 items-center gap-x-8 gap-y-10 sm:max-w-xl sm:grid-cols-6 sm:gap-x-10 lg:mx-0 lg:max-w-none lg:grid-cols-5">
                    <!-- Image placeholders -->
                    <div id="as_seen_on_1_placeholder" class="col-span-2 max-h-12 w-full object-contain lg:col-span-1 bg-gray-200 animate-pulse h-12 rounded"></div>
                    <img id="as_seen_on_1" class="col-span-2 max-h-12 w-full object-contain lg:col-span-1 custom-value-as_seen_on_1 hidden" src="" alt="As Seen On 1" width="158" height="48">

                    <div id="as_seen_on_2_placeholder" class="col-span-2 max-h-12 w-full object-contain lg:col-span-1 bg-gray-200 animate-pulse h-12 rounded"></div>
                    <img id="as_seen_on_2" class="col-span-2 max-h-12 w-full object-contain lg:col-span-1 custom-value-as_seen_on_2 hidden" src="" alt="As Seen On 2" width="158" height="48">

                    <div id="as_seen_on_3_placeholder" class="col-span-2 max-h-12 w-full object-contain lg:col-span-1 bg-gray-200 animate-pulse h-12 rounded"></div>
                    <img id="as_seen_on_3" class="col-span-2 max-h-12 w-full object-contain lg:col-span-1 custom-value-as_seen_on_3 hidden" src="" alt="As Seen On 3" width="158" height="48">

                    <div id="as_seen_on_4_placeholder" class="col-span-2 max-h-12 w-full object-contain sm:col-start-2 lg:col-span-1 bg-gray-200 animate-pulse h-12 rounded"></div>
                    <img id="as_seen_on_4" class="col-span-2 max-h-12 w-full object-contain sm:col-start-2 lg:col-span-1 custom-value-as_seen_on_4 hidden" src="" alt="As Seen On 4" width="158" height="48">

                    <div id="as_seen_on_5_placeholder" class="col-span-2 col-start-2 max-h-12 w-full object-contain sm:col-start-auto lg:col-span-1 bg-gray-200 animate-pulse h-12 rounded"></div>
                    <img id="as_seen_on_5" class="col-span-2 col-start-2 max-h-12 w-full object-contain sm:col-start-auto lg:col-span-1 custom-value-as_seen_on_5 hidden" src="" alt="As Seen On 5" width="158" height="48">
                </div>
            </div>
        </div>
    </section>

    <!-- Section 4 -->
    <div class="bg-light-background py-24 sm:py-32 bg-fixed bg-center bg-cover" style="background-image: url('https://assets.cdn.filesafe.space/c3cmUrbBhdgs54adfIYP/media/64380887a7983a65ebeebce0.jpeg');">
        <div class="mx-auto max-w-6xl px-6 lg:px-8">
            <!-- Section Header -->
            <div class="mx-auto max-w-4xl text-center">
                <h2 id="why_you_need_this_preheadline" class="text-base font-semibold leading-7 text-link-text custom-value-why_you_need_this_preheadline custom-value-clickable custom-value-hoverable">
                </h2>
                <p class="mt-2 text-4xl font-bold tracking-tight text-bold-text sm:text-5xl">
                    Does this sound like you?
                </p>
            </div>

            <!-- Content Grid -->
            <div class="isolate mx-auto mt-10 grid max-w-md grid-cols-1 gap-8 lg:mx-0 lg:max-w-none lg:grid-cols-2">
                <!-- Pain Points -->
                <div class="rounded-3xl p-8 ring-1 ring-gray-200 bg-white xl:p-10">
                    <ul role="list" class="mt-8 space-y-6 text-lg leading-8 text-gray-700 xl:mt-10">
                        <!-- Pain Point 1 -->
                        <li class="flex gap-x-3">
                            <svg class="h-6 w-6 flex-none text-icon-color" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.707a1 1 0 00-1.414-1.414L10 8.586 7.707 6.293a1 1 0 00-1.414 1.414L8.586 10l-2.293 2.293a1 1 0 101.414 1.414L10 11.414l2.293-2.293 1.414-1.414z" clip-rule="evenodd"/>
                            </svg>
                            <div id="painpoint_without_course_1" class="custom-value-painpoint_without_course_1 custom-value-clickable custom-value-hoverable">
                            </div>
                        </li>
                        <!-- Pain Point 2 -->
                        <!-- ... other pain points ... -->
                    </ul>
                </div>

                <!-- Realized Desires -->
                <div class="rounded-3xl p-8 ring-1 ring-gray-200 bg-white xl:p-10">
                    <ul role="list" class="mt-8 space-y-6 text-lg leading-8 text-gray-700 xl:mt-10">
                        <!-- Realized Desire 1 -->
                        <li class="flex gap-x-3">
                            <svg class="h-6 w-6 flex-none text-icon-color" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 011.143 1.052l-7.506 9.84a.75.75 0 01-1.137.09L4.8 11.706a.75.75 0 111.06-1.06l2.088 2.088L15.561 4.153a.75.75 0 01.143-.143z" clip-rule="evenodd"/>
                            </svg>
                            <div id="realized_desire_after_course_completion_1" class="custom-value-realized_desire_after_course_completion_1 custom-value-clickable custom-value-hoverable">
                            </div>
                        </li>
                        <!-- Realized Desire 2 -->
                        <!-- ... other realized desires ... -->
                    </ul>
                </div>
            </div>

            <!-- Call to Action -->
            <div class="mt-10 flex justify-center">
                <a href="#" class="rounded-md bg-buttons px-6 py-3 text-lg font-semibold text-button-text shadow-sm hover:bg-button-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-buttons">
                    Get instant access here!
                </a>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Configuration variables
        const config = {
            temporaryWebsiteUrl: 'https://html-starter-coral.vercel.app/cc360-ai-templates-sep-19-2024-CannySmith-fdsa-8016237631.html',
            apiEndpoints: {
                aiRequest: 'https://lnga43ibdg2xpgtijjizbacvou0hbgho.lambda-url.us-west-2.on.aws/',
                saveChanges: 'https://mumtkxnj7kxedj7d6hue7qnl3e0fxcnz.lambda-url.us-west-2.on.aws/',
                fetchData: 'https://ionnjdho4ntxa2latjo5yf7i3m0yswoy.lambda-url.us-west-2.on.aws/'
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            'use strict';

            const changeWithAIBubble = document.getElementById('changeWithAI');
            const saveChangesButton = document.getElementById('saveChanges');
            const modal = document.getElementById('modal');
            const submitButton = document.getElementById('submitButton');
            const cancelButton = document.getElementById('cancelButton');
            const userRequest = document.getElementById('userRequest');
            const selectedItems = [];

            // Show Change with AI Modal
            changeWithAIBubble.addEventListener('click', () => {
                modal.classList.remove('hidden');
                userRequest.focus();
                console.log('Change with AI clicked, showing modal.');
            });

            // Hide Modal on Cancel
            cancelButton.addEventListener('click', () => {
                modal.classList.add('hidden');
                changeWithAIBubble.focus();
                console.log('Cancel clicked, hiding modal.');
            });

            // Submit AI Request
            submitButton.addEventListener('click', async () => {
                const customValues = {};
                selectedItems.forEach(item => {
                    const key = Object.keys(item)[0];
                    customValues[key] = item[key];
                });

                console.log('Submitting AI request with data:', {
                    temporary_website_url: config.temporaryWebsiteUrl,
                    userRequest: userRequest.value,
                    customValues: customValues
                });

                submitButton.textContent = 'Submitting...';
                submitButton.disabled = true;

                try {
                    const response = await axios.post(config.apiEndpoints.aiRequest, {
                        temporary_website_url: config.temporaryWebsiteUrl,
                        userRequest: userRequest.value,
                        customValues: customValues
                    });

                    submitButton.textContent = 'Submit';
                    submitButton.disabled = false;
                    userRequest.value = '';
                    modal.classList.add('hidden');
                    changeWithAIBubble.focus();
                    console.log('AI Response:', response.data);
                    // Handle response
                } catch (error) {
                    submitButton.textContent = 'Submit';
                    submitButton.disabled = false;
                    console.error('Error submitting to AI:', error);
                }
            });

            // Save Changes
            saveChangesButton.addEventListener('click', async () => {
                saveChangesButton.textContent = 'Saving...';
                saveChangesButton.disabled = true;

                const customValues = {};
                selectedItems.forEach(item => {
                    const key = Object.keys(item)[0];
                    const element = document.querySelector(`.custom-value-${key}`);
                    if (element) {
                        customValues[key] = element.textContent.trim();
                    }
                });

                console.log('Saving changes with data:', {
                    temporary_website_url: config.temporaryWebsiteUrl,
                    customValues: customValues
                });

                try {
                    const response = await axios.post(config.apiEndpoints.saveChanges, {
                        temporary_website_url: config.temporaryWebsiteUrl,
                        customValues: customValues
                    });

                    saveChangesButton.textContent = 'Save';
                    saveChangesButton.disabled = false;
                    if (response.status === 200) {
                        console.log('Changes saved successfully.');
                        alert('Changes saved successfully!');
                    } else {
                        console.error('Failed to save changes.');
                        alert('Failed to save changes.');
                    }
                } catch (error) {
                    saveChangesButton.textContent = 'Save';
                    saveChangesButton.disabled = false;
                    console.error('Error saving changes:', error);
                    alert('An error occurred while saving changes.');
                }
            });

            // Hover and Select Elements
            document.addEventListener('mouseover', event => {
                const target = event.target.closest('.custom-value-hoverable');
                if (target && !target.classList.contains('selected')) {
                    target.classList.add('border', 'border-white');
                    console.log(`Hovering over ${target.id || target.className}`);
                }
            });

            document.addEventListener('mouseout', event => {
                const target = event.target.closest('.custom-value-hoverable');
                if (target && !target.classList.contains('selected')) {
                    target.classList.remove('border', 'border-white');
                    console.log(`Stopped hovering over ${target.id || target.className}`);
                }
            });

            document.addEventListener('click', event => {
                const target = event.target.closest('.custom-value-clickable');
                if (!target) return;

                if (target.isContentEditable) {
                    // Deselect
                    target.classList.remove('selected', 'border-red-500', 'bg-red-500', 'bg-opacity-10');
                    target.removeAttribute('contenteditable');
                    if (!target.classList.contains('border-white')) {
                        target.classList.remove('border');
                    }
                    const classList = Array.from(target.classList);
                    const customValueClass = classList.find(cls => cls.startsWith('custom-value-') && !cls.endsWith('-hoverable') && !cls.endsWith('-clickable'));
                    if (customValueClass) {
                        const key = customValueClass.replace('custom-value-', '');
                        const index = selectedItems.findIndex(item => item[key]);
                        if (index > -1) {
                            selectedItems.splice(index, 1);
                        }
                    }
                    console.log(`Element ${target.id || target.className} deselected`);
                } else {
                    // Select
                    target.classList.add('selected', 'border', 'border-red-500', 'bg-red-500', 'bg-opacity-10');
                    target.setAttribute('contenteditable', 'true');
                    target.focus();
                    const classList = Array.from(target.classList);
                    const customValueClass = classList.find(cls => cls.startsWith('custom-value-') && !cls.endsWith('-hoverable') && !cls.endsWith('-clickable'));
                    if (customValueClass) {
                        const key = customValueClass.replace('custom-value-', '');
                        const itemText = target.textContent;
                        if (!selectedItems.some(item => item[key] === itemText)) {
                            const newItem = {};
                            newItem[key] = itemText;
                            selectedItems.push(newItem);
                        }
                    }
                    console.log(`Element ${target.id || target.className} selected`);
                }

                event.stopPropagation();
            });

            // Fetch Data
            fetchData();
        });

        async function fetchData() {
            'use strict';
            console.log('Fetching data for:', config.temporaryWebsiteUrl);

            const maxRetries = 3;
            for (let attempts = 0; attempts < maxRetries; attempts++) {
                try {
                    const response = await axios.post(config.apiEndpoints.fetchData, {
                        temporary_website_url: config.temporaryWebsiteUrl
                    });

                    if (response.status === 200) {
                        const data = response.data;
                        console.log('Data fetched:', data);

                        for (const key in data) {
                            if (data.hasOwnProperty(key)) {
                                const element = document.getElementById(key);
                                const placeholder = document.getElementById(`${key}_placeholder`);

                                if (element) {
                                    if (element.tagName.toLowerCase() === 'img') {
                                        element.src = data[key];
                                    } else {
                                        element.innerHTML = data[key];
                                    }
                                    element.classList.remove('hidden');
                                    if (placeholder) {
                                        placeholder.classList.add('hidden');
                                    }
                                }

                                const elements = document.querySelectorAll(`.custom-value-${key}`);
                                elements.forEach(el => {
                                    if (el.tagName.toLowerCase() === 'img') {
                                        el.src = data[key];
                                    } else {
                                        el.innerHTML = data[key];
                                    }
                                    el.classList.remove('hidden');
                                    const placeholderElement = document.getElementById(`${key}_placeholder`);
                                    if (placeholderElement) {
                                        placeholderElement.classList.add('hidden');
                                    }
                                });
                            }
                        }
                        return; // Data fetched successfully
                    } else {
                        console.error('Error fetching data:', response);
                    }
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
                console.log(`Retrying... (${maxRetries - attempts - 1} retries left)`);
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            console.error('Failed to fetch data after maximum retries.');
        }
    </script>
</body>
</html>