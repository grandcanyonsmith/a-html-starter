<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access Our Test Account</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 max-w-md">
        <h1 class="text-3xl font-bold mb-4">Access Our Test Account</h1>
        <p class="mb-6 text-gray-700">
            Great, here is access to one of our test accounts. Fill out this form and youâ€™ll be sent an email to login. Just set your password.
        </p>
        
        <div id="successMessage" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
            Thank you! You'll receive an email with login instructions shortly.
        </div>

        <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
            <!-- Error messages will be displayed here -->
        </div>
        
        <div class="bg-white p-4 rounded shadow">
            <form id="accessForm">
                <div class="mb-4">
                    <label for="firstName" class="block text-gray-700">First Name</label>
                    <input type="text" name="firstName" id="firstName" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label for="lastName" class="block text-gray-700">Last Name</label>
                    <input type="text" name="lastName" id="lastName" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label for="email" class="block text-gray-700">Email</label>
                    <input type="email" name="email" id="email" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label for="phone" class="block text-gray-700">Phone (optional)</label>
                    <input type="text" name="phone" id="phone" class="w-full p-2 border rounded">
                </div>
                <button type="submit" id="submitButton" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded w-full">Submit</button>
            </form>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const accessForm = document.getElementById('accessForm');
            const submitButton = document.getElementById('submitButton');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');

            accessForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                console.log('Form submitted');

                // Change button text to indicate processing
                submitButton.textContent = 'Submitting...';
                submitButton.disabled = true;

                const formData = new FormData(accessForm);
                const userData = {
                    requestType: 'create_user',
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    password: '', // Assuming the backend will handle password setup via email
                    phone: formData.get('phone'),
                    role: 'user' // Default role
                };

                try {
                    console.log('Sending user data:', userData);
                    const response = await axios.post('https://pk27rf2b6cl4mdof27koyj7zfu0reobl.lambda-url.us-west-2.on.aws/', userData);
                    console.log('Response:', response.data);

                    if (response.data.error) {
                        const messages = response.data.message;
                        errorMessage.innerHTML = messages.join('<br>');
                        errorMessage.classList.remove('hidden');
                        successMessage.classList.add('hidden');
                    } else {
                        successMessage.classList.remove('hidden');
                        errorMessage.classList.add('hidden');
                        accessForm.reset();
                    }
                } catch (error) {
                    console.error('Error submitting form:', error);
                    errorMessage.textContent = 'An error occurred while submitting the form. Please try again later.';
                    errorMessage.classList.remove('hidden');
                    successMessage.classList.add('hidden');
                } finally {
                    // Reset button text and state
                    submitButton.textContent = 'Submit';
                    submitButton.disabled = false;
                }
            });
        });
    </script>
</body>
</html>