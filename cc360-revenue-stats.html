<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-900" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales Data Dashboard</title>
  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Chart.js Zoom Plugin CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>
</head>
<body class="h-full">
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 focus:bg-gray-800 focus:text-white focus:p-4">
    Skip to main content
  </a>
  <!-- Navigation Bar -->
  <nav class="bg-gray-800" role="navigation" aria-label="Main Navigation">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Logo and title -->
        <div class="flex items-center">
          <a href="#" class="flex-shrink-0">
            <img class="h-8 w-auto" src="https://images.leadconnectorhq.com/image/f_webp/q_80/r_1200/u_https://assets.cdn.filesafe.space/c2DjRsOo4e13Od6ZTU6S/media/636547bb724368117f1cc776.png" alt="Company Logo">
          </a>
          <div class="hidden md:block">
            <ul class="ml-10 flex items-baseline space-x-4">
              <!-- Navigation links -->
              <li><a href="users-cc360-stats.html" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Customer Success</a></li>
              <li><a href="#" class="bg-gray-900 text-white px-3 py-2 rounded-md text-sm font-medium" aria-current="page">Sales</a></li>
              <li><a href="levi-commission-tracker.html" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Levi Tracker</a></li>
            </ul>
          </div>
        </div>
        <!-- Mobile menu button -->
        <div class="-mr-2 flex md:hidden">
          <button id="mobile-menu-button" type="button" aria-controls="mobile-menu" aria-expanded="false" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-label="Toggle navigation menu">
            <!-- Menu open: "hidden", Menu closed: "block" -->
            <svg class="block h-6 w-6" id="menu-open-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
            <!-- Menu open: "block", Menu closed: "hidden" -->
            <svg class="hidden h-6 w-6" id="menu-close-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
    <!-- Mobile menu, toggle classes based on menu state -->
    <div class="hidden md:hidden" id="mobile-menu">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
        <!-- Mobile Navigation Links -->
        <ul>
          <li><a href="users-cc360-stats.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Customer Success</a></li>
          <li><a href="#" class="bg-gray-900 text-white block px-3 py-2 rounded-md text-base font-medium" aria-current="page">Sales</a></li>
          <li><a href="levi-commission-tracker.html" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Levi Tracker</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main id="main-content" class="py-10" tabindex="-1">
    <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 px-4">
      <!-- Page Heading -->
      <header class="text-center">
        <h1 class="text-3xl font-bold text-white">Sales Data Dashboard</h1>
        <p class="mt-2 text-lg text-gray-300">Overview of sales data based on the selected date range</p>
      </header>

      <!-- Notification Container -->
      <div id="notification-container" aria-live="assertive" aria-atomic="true" class="fixed inset-0 flex items-end px-4 py-6 pointer-events-none sm:p-6 sm:items-start">
        <!-- Notifications will be dynamically inserted here -->
      </div>

      <!-- Date Picker and Fetch Button -->
      <section class="mt-8 flex flex-wrap items-center justify-center" aria-label="Date Selection and Data Fetch">
        <!-- Date Quick Select Options -->
        <div class="flex flex-wrap items-center justify-center mb-4 md:mb-0">
          <label for="date-range" class="text-white mr-2">Quick Select:</label>
          <select id="date-range" class="rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mr-4" aria-label="Select Quick Date Range">
            <option value="">Custom Range</option>
            <option value="last_week">Last Week</option>
            <option value="last_month" selected>Last Month</option>
            <option value="last_quarter">Last Quarter</option>
          </select>
        </div>
        <div class="flex flex-wrap items-center justify-center">
          <label for="start_date" class="text-white mr-2">Start Date:</label>
          <input type="date" id="start_date" class="rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mr-4" aria-label="Select Start Date">
          <label for="end_date" class="text-white mr-2">End Date:</label>
          <input type="date" id="end_date" class="rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mr-4" aria-label="Select End Date">
        </div>
        <button id="fetch-button" onclick="fetchSalesData()" class="relative inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 mt-4 md:mt-0" aria-label="Fetch Sales Data">
          <svg id="fetch-button-spinner" class="hidden animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
          </svg>
          <span id="fetch-button-text">Fetch Sales Data</span>
        </button>
      </section>

      <!-- Stats Cards -->
      <section class="mt-10" id="stats-section" aria-label="Summary Statistics">
        <!-- Loading Placeholder -->
        <div id="stats-cards-loading" class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
          <!-- Placeholder Card -->
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg" aria-hidden="true">
            <div class="px-4 py-5 sm:p-6 animate-pulse">
              <dt class="text-sm font-medium text-gray-400 truncate">
                <div class="h-4 bg-gray-700 rounded w-3/4"></div>
              </dt>
              <dd class="mt-1 text-3xl font-semibold text-white">
                <div class="h-8 bg-gray-700 rounded w-1/2"></div>
              </dd>
              <dd class="text-sm text-gray-400">
                <div class="h-4 bg-gray-700 rounded w-1/4"></div>
              </dd>
            </div>
          </div>
          <!-- Repeat for other placeholder cards -->
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg" aria-hidden="true">
            <div class="px-4 py-5 sm:p-6 animate-pulse">
              <dt class="text-sm font-medium text-gray-400 truncate">
                <div class="h-4 bg-gray-700 rounded w-3/4"></div>
              </dt>
              <dd class="mt-1 text-3xl font-semibold text-white">
                <div class="h-8 bg-gray-700 rounded w-1/2"></div>
              </dd>
              <dd class="text-sm text-gray-400">
                <div class="h-4 bg-gray-700 rounded w-1/4"></div>
              </dd>
            </div>
          </div>
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg" aria-hidden="true">
            <div class="px-4 py-5 sm:p-6 animate-pulse">
              <dt class="text-sm font-medium text-gray-400 truncate">
                <div class="h-4 bg-gray-700 rounded w-3/4"></div>
              </dt>
              <dd class="mt-1 text-3xl font-semibold text-white">
                <div class="h-8 bg-gray-700 rounded w-1/2"></div>
              </dd>
              <dd class="text-sm text-gray-400">
                <div class="h-4 bg-gray-700 rounded w-1/4"></div>
              </dd>
            </div>
          </div>
        </div>

        <!-- Actual Stats Cards -->
        <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3 hidden" id="stats-cards">
          <!-- Total Sales -->
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-400 truncate">
                Total Sales
              </dt>
              <dd id="total-amount" class="mt-1 text-3xl font-semibold text-white">
                $0.00
              </dd>
              <dd id="total-sales-amount" class="text-sm text-gray-400">
                Sales Amount: 0
              </dd>
            </div>
          </div>
          <!-- Demo Completed -->
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-400 truncate">
                Demo Completed
              </dt>
              <dd id="demo-completed-amount" class="mt-1 text-3xl font-semibold text-white">
                $0.00
              </dd>
              <dd id="demo-completed-sales-amount" class="text-sm text-gray-400">
                Sales Amount: 0
              </dd>
            </div>
          </div>
          <!-- No Demo Completed -->
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-400 truncate">
                No Demo Completed
              </dt>
              <dd id="no-demo-completed-amount" class="mt-1 text-3xl font-semibold text-white">
                $0.00
              </dd>
              <dd id="no-demo-completed-sales-amount" class="text-sm text-gray-400">
                Sales Amount: 0
              </dd>
            </div>
          </div>
          <!-- Avg. Daily MRR Increase -->
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg sm:col-span-2 lg:col-span-1">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-400 truncate">
                Avg. Daily MRR Increase
              </dt>
              <dd id="avg-daily-mrr" class="mt-1 text-3xl font-semibold text-white">
                $0.00
              </dd>
            </div>
          </div>
          <!-- MRR Increase Trajectory -->
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg sm:col-span-2 lg:col-span-2">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-400 truncate">
                MRR Increase Trajectory
              </dt>
              <dd id="mrr-trajectory" class="mt-1 text-3xl font-semibold text-white">
                $0.00
              </dd>
            </div>
          </div>
        </div>
      </section>

      <!-- MRR Increase from Each Source -->
      <section class="mt-10" id="mrr-section" aria-label="MRR Increase from Each Source">
        <h2 class="text-2xl leading-6 font-medium text-white">Total MRR Increase from Each Source</h2>
        <!-- Loading Placeholder -->
        <div id="source-mrr-increase-loading" class="mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
          <!-- Placeholder Card -->
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg animate-pulse" aria-hidden="true">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-400 truncate">
                <div class="h-4 bg-gray-700 rounded w-3/4"></div>
              </dt>
              <dd class="mt-1 text-3xl font-semibold text-white">
                <div class="h-8 bg-gray-700 rounded w-1/2"></div>
              </dd>
            </div>
          </div>
          <!-- Repeat placeholder cards as needed -->
        </div>
        <div id="source-mrr-increase" class="mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3 hidden">
          <!-- Cards will be dynamically inserted here -->
        </div>
      </section>

      <!-- Source Counts -->
      <section class="mt-10" id="source-counts-section" aria-label="Source Distribution">
        <h2 class="text-2xl leading-6 font-medium text-white">Source Distribution</h2>
        <!-- Loading Placeholder -->
        <div id="source-counts-loading" class="mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
          <!-- Placeholder Card -->
          <div class="bg-gray-800 overflow-hidden shadow rounded-lg animate-pulse" aria-hidden="true">
            <div class="px-4 py-5 sm:p-6">
              <dt class="text-sm font-medium text-gray-400 truncate">
                <div class="h-4 bg-gray-700 rounded w-3/4"></div>
              </dt>
              <dd class="mt-1 text-3xl font-semibold text-white">
                <div class="h-8 bg-gray-700 rounded w-1/2"></div>
              </dd>
              <dd class="text-sm text-gray-400">
                <div class="h-4 bg-gray-700 rounded w-1/4"></div>
              </dd>
            </div>
          </div>
          <!-- Repeat placeholder cards as needed -->
        </div>
        <div id="source-counts" class="mt-5 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3 hidden">
          <!-- Cards will be dynamically inserted here -->
        </div>
      </section>

      <!-- Grouped Sales Data Table -->
      <section class="mt-10" id="grouped-table-section" aria-label="Sales Data by Product">
        <h2 class="text-2xl leading-6 font-medium text-white">Sales Data by Product</h2>
        <!-- Loading Placeholder -->
        <div id="grouped-table-loading" class="mt-5 animate-pulse" aria-hidden="true">
          <div class="shadow overflow-hidden border-b border-gray-700 sm:rounded-lg">
            <table class="min-w-full divide-y divide-gray-700">
              <thead>
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Product Name</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Price</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Total Revenue</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Sales Amount</th>
                </tr>
              </thead>
              <tbody class="bg-gray-800 divide-y divide-gray-700">
                <!-- Placeholder Rows -->
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="h-4 bg-gray-700 rounded w-3/4"></div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="h-4 bg-gray-700 rounded w-1/2"></div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="h-4 bg-gray-700 rounded w-1/3"></div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="h-4 bg-gray-700 rounded w-1/4"></div>
                  </td>
                </tr>
                <!-- Repeat placeholder rows as needed -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="mt-5">
          <!-- Filters -->
          <div class="flex flex-wrap items-center justify-between mb-4">
            <div class="flex flex-wrap items-center mb-2 md:mb-0">
              <label for="grouped-search" class="text-gray-300 mr-2">Search:</label>
              <input type="text" id="grouped-search" oninput="filterGroupedTable()" class="rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Search products..." aria-label="Search products">
            </div>
            <div class="flex items-center">
              <label for="grouped-rows-per-page" class="text-gray-300 mr-2">Rows per page:</label>
              <select id="grouped-rows-per-page" onchange="renderGroupedTable()" class="rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500" aria-label="Select number of rows per page">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="All">All</option>
              </select>
            </div>
          </div>
          <div class="shadow overflow-hidden border-b border-gray-700 sm:rounded-lg">
            <table id="grouped-sales-table" class="min-w-full divide-y divide-gray-700">
              <thead>
                <tr>
                  <th scope="col" onclick="sortGroupedTable('Product Name')" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:text-white">
                    Product Name
                    <span id="grouped-sort-icon-Product Name" aria-hidden="true"></span>
                  </th>
                  <th scope="col" onclick="sortGroupedTable('Price')" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:text-white">
                    Price
                    <span id="grouped-sort-icon-Price" aria-hidden="true"></span>
                  </th>
                  <th scope="col" onclick="sortGroupedTable('Total Revenue')" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:text-white">
                    Total Revenue
                    <span id="grouped-sort-icon-Total Revenue" aria-hidden="true"></span>
                  </th>
                  <th scope="col" onclick="sortGroupedTable('Sales Amount')" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:text-white">
                    Sales Amount
                    <span id="grouped-sort-icon-Sales Amount" aria-hidden="true"></span>
                  </th>
                </tr>
              </thead>
              <tbody id="grouped-table-body" class="bg-gray-800 divide-y divide-gray-700">
                <!-- Rows will be inserted here -->
              </tbody>
            </table>
          </div>
          <!-- Pagination -->
          <div class="mt-4 flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-300">
                Showing <span id="grouped-start-index">1</span> to <span id="grouped-end-index">10</span> of <span id="grouped-total-entries">0</span> entries
              </p>
            </div>
            <div>
              <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <button onclick="previousGroupedPage()" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-700 bg-gray-800 text-sm font-medium text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" aria-label="Previous page">
                  Previous
                </button>
                <button onclick="nextGroupedPage()" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-700 bg-gray-800 text-sm font-medium text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" aria-label="Next page">
                  Next
                </button>
              </nav>
            </div>
          </div>
        </div>
      </section>

      <!-- Detailed Sales Data Table -->
      <section class="mt-10" id="detailed-table-section" aria-label="Detailed Sales Data">
        <h2 class="text-2xl leading-6 font-medium text-white">Detailed Sales Data</h2>
        <!-- Loading Placeholder -->
        <div id="detailed-table-loading" class="mt-5 animate-pulse" aria-hidden="true">
          <div class="shadow overflow-hidden border-b border-gray-700 sm:rounded-lg">
            <table class="min-w-full divide-y divide-gray-700">
              <thead>
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Email</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Product Name</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Price</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Source</th>
                </tr>
              </thead>
              <tbody class="bg-gray-800 divide-y divide-gray-700">
                <!-- Placeholder Rows -->
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="h-4 bg-gray-700 rounded w-3/4"></div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="h-4 bg-gray-700 rounded w-1/2"></div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="h-4 bg-gray-700 rounded w-1/3"></div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="h-4 bg-gray-700 rounded w-1/4"></div>
                  </td>
                </tr>
                <!-- Repeat placeholder rows as needed -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="mt-5">
          <!-- Filters -->
          <div class="flex flex-wrap items-center justify-between mb-4">
            <div class="flex flex-wrap items-center mb-2 md:mb-0">
              <label for="detailed-search" class="text-gray-300 mr-2">Search:</label>
              <input type="text" id="detailed-search" oninput="filterDetailedTable()" class="rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Search emails, products..." aria-label="Search detailed sales data">
            </div>
            <div class="flex items-center">
              <label for="detailed-rows-per-page" class="text-gray-300 mr-2">Rows per page:</label>
              <select id="detailed-rows-per-page" onchange="renderDetailedTable()" class="rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500" aria-label="Select number of rows per page">
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="All">All</option>
              </select>
            </div>
          </div>
          <div class="shadow overflow-hidden border-b border-gray-700 sm:rounded-lg">
            <table id="detailed-sales-table" class="min-w-full divide-y divide-gray-700">
              <thead>
                <tr>
                  <th scope="col" onclick="sortDetailedTable('Email')" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:text-white">
                    Email
                    <span id="detailed-sort-icon-Email" aria-hidden="true"></span>
                  </th>
                  <th scope="col" onclick="sortDetailedTable('Product Name')" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:text-white">
                    Product Name
                    <span id="detailed-sort-icon-Product Name" aria-hidden="true"></span>
                  </th>
                  <th scope="col" onclick="sortDetailedTable('Price')" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:text-white">
                    Price
                    <span id="detailed-sort-icon-Price" aria-hidden="true"></span>
                  </th>
                  <th scope="col" onclick="sortDetailedTable('Source')" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:text-white">
                    Source
                    <span id="detailed-sort-icon-Source" aria-hidden="true"></span>
                  </th>
                </tr>
              </thead>
              <tbody id="detailed-table-body" class="bg-gray-800 divide-y divide-gray-700">
                <!-- Rows will be inserted here -->
              </tbody>
            </table>
          </div>
          <!-- Pagination -->
          <div class="mt-4 flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-300">
                Showing <span id="detailed-start-index">1</span> to <span id="detailed-end-index">10</span> of <span id="detailed-total-entries">0</span> entries
              </p>
            </div>
            <div>
              <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <button onclick="previousDetailedPage()" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-700 bg-gray-800 text-sm font-medium text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" aria-label="Previous page">
                  Previous
                </button>
                <button onclick="nextDetailedPage()" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-700 bg-gray-800 text-sm font-medium text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" aria-label="Next page">
                  Next
                </button>
              </nav>
            </div>
          </div>
        </div>
      </section>

      <!-- Source Pie Chart -->
      <section class="mt-10" id="chart-section" aria-label="Source Distribution Chart">
        <h2 class="text-2xl leading-6 font-medium text-white">Source Distribution Chart</h2>
        <!-- Loading Placeholder -->
        <div id="chart-loading" class="mt-5 animate-pulse" aria-hidden="true">
          <div class="h-64 bg-gray-700 rounded"></div>
        </div>
        <div class="mt-5 hidden" id="chart-container">
          <canvas id="sourcePieChart" role="img" aria-label="Pie chart showing source distribution"></canvas>
        </div>
      </section>
    </div>
  </main>

  <!-- JavaScript -->
  <script>
    // Global Variables for Sorting and Pagination
    let groupedDataArray = [];
    let groupedCurrentPage = 1;
    let groupedRowsPerPage = 10;
    let groupedSortColumn = '';
    let groupedSortDirection = 'asc';

    let detailedDataArray = [];
    let detailedCurrentPage = 1;
    let detailedRowsPerPage = 25;
    let detailedSortColumn = '';
    let detailedSortDirection = 'asc';

    // Notification Function
    function showNotification(message, type = 'info') {
      const notificationContainer = document.getElementById('notification-container');
      // Create a notification div
      const notification = document.createElement('div');
      notification.classList.add('max-w-sm', 'w-full', 'bg-white', 'shadow-lg', 'rounded-lg', 'pointer-events-auto', 'ring-1', 'ring-black', 'ring-opacity-5', 'overflow-hidden', 'mb-4');
      notification.setAttribute('role', 'alert');
      // Adjust styles based on type
      let borderColor, textColor, icon;
      if (type === 'success') {
        borderColor = 'border-green-400';
        textColor = 'text-green-700';
        icon = '✓';
      } else if (type === 'error') {
        borderColor = 'border-red-400';
        textColor = 'text-red-700';
        icon = '✖';
      } else if (type === 'warning') {
        borderColor = 'border-yellow-400';
        textColor = 'text-yellow-700';
        icon = '⚠';
      } else {
        borderColor = 'border-blue-400';
        textColor = 'text-blue-700';
        icon = 'ℹ';
      }
      notification.innerHTML = `
        <div class="p-4 border-l-4 ${borderColor}">
          <div class="flex">
            <div class="flex-shrink-0">
              <span class="${textColor}" aria-hidden="true">${icon}</span>
            </div>
            <div class="ml-3">
              <p class="text-sm font-medium ${textColor}">
                ${message}
              </p>
            </div>
            <div class="ml-auto pl-3">
              <div class="-mx-1.5 -my-1.5">
                <button type="button" class="inline-flex bg-white rounded-md p-1.5 ${textColor} hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" aria-label="Dismiss notification">
                  <span class="sr-only">Dismiss</span>
                  <!-- X icon -->
                  <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9l5 5L14 15l-4-4-4 4L5 14l5-5L5 5l1-1 4 4 4-4 1 1-5 5z" clip-rule="evenodd"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      notificationContainer.appendChild(notification);
      // Add event listener to dismiss button
      const dismissButton = notification.querySelector('button');
      dismissButton.addEventListener('click', () => {
        notificationContainer.removeChild(notification);
      });
      // Remove notification after 5 seconds
      setTimeout(() => {
        if (notification.parentNode === notificationContainer) {
          notificationContainer.removeChild(notification);
        }
      }, 5000);
    }

    // Mobile menu toggle functionality
    document.addEventListener('DOMContentLoaded', () => {
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      const menuOpenIcon = document.getElementById('menu-open-icon');
      const menuCloseIcon = document.getElementById('menu-close-icon');

      mobileMenuButton.addEventListener('click', () => {
        const isOpen = mobileMenu.classList.contains('hidden');
        mobileMenu.classList.toggle('hidden', !isOpen);
        menuOpenIcon.classList.toggle('hidden', !isOpen);
        menuCloseIcon.classList.toggle('hidden', isOpen);

        console.log('Mobile menu toggled:', isOpen ? 'Opened' : 'Closed');
      });

      const today = new Date();
      const priorDate = new Date();
      priorDate.setDate(today.getDate() - 30);
      document.getElementById('start_date').valueAsDate = priorDate;
      document.getElementById('end_date').valueAsDate = today;

      // Set default date range based on quick select
      setDateRange('last_month');

      // Event listener for date range quick select
      document.getElementById('date-range').addEventListener('change', (e) => {
        setDateRange(e.target.value);
      });

      // Initialize rows per page selects
      document.getElementById('grouped-rows-per-page').value = '10';
      document.getElementById('detailed-rows-per-page').value = '25';

      // Fetch data on load
      fetchSalesData();
    });

    function setDateRange(value) {
      const startDateInput = document.getElementById('start_date');
      const endDateInput = document.getElementById('end_date');
      const today = new Date();
      let startDate;
      let endDate = new Date();

      if (value === 'last_week') {
        startDate = new Date();
        startDate.setDate(today.getDate() - 7);
      } else if (value === 'last_month') {
        startDate = new Date();
        startDate.setMonth(today.getMonth() - 1);
      } else if (value === 'last_quarter') {
        startDate = new Date();
        startDate.setMonth(today.getMonth() - 3);
      } else {
        return;
      }

      startDateInput.valueAsDate = startDate;
      endDateInput.valueAsDate = endDate;
    }

    // Helper functions
    function formatCurrency(value) {
      return `$${parseFloat(value).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      const options = { month: 'short', day: 'numeric' };
      return `${date.toLocaleDateString(undefined, options)} ${date.toTimeString().split(' ')[0].slice(0, 5)}`;
    }

    function calculateWorkdays(startDate, endDate) {
      let count = 0;
      const currentDate = new Date(startDate);
      while (currentDate <= endDate) {
        const dayOfWeek = currentDate.getDay();
        if (dayOfWeek !== 0 && dayOfWeek !== 6) { // Skip Sunday (0) and Saturday (6)
          count++;
        }
        currentDate.setDate(currentDate.getDate() + 1);
      }
      return count;
    }

    function getBadgeClass(productName) {
      const badgeClasses = {
        "Premium (Free Trial)": "bg-gray-400 text-gray-200",
        "Premium (Paid)": "bg-red-400 text-red-800",
        "Elite (Free Trial)": "bg-yellow-400 text-yellow-800",
        "Elite (Paid)": "bg-green-400 text-green-800",
        "Starter (Free Trial)": "bg-blue-400 text-blue-800",
        "Starter (Paid)": "bg-indigo-400 text-indigo-800",
        "Basic (Free)": "bg-purple-400 text-purple-800",
        "Basic (Paid)": "bg-pink-400 text-pink-800",
        "Platinum (Paid)": "bg-orange-400 text-orange-800"
      };
      return badgeClasses[productName] || "bg-gray-400 text-gray-800";
    }

    function filterTags(tags) {
      if (tags.includes('@can-why-i-left-kajabi-if-lal')) {
        return 'CAN-Kajabi LAL';
      }
      if (tags.includes('@why-i-left-kajabi-if-lal')) {
        return 'US-Kajabi LAL';
      }
      if (tags.includes('@can-why-i-left-kajabi-if-interests-gurus')) {
        return 'CAN-Kajabi Gurus';
      }
      if (tags.includes('@why-i-left-kajabi-if-interests-gurus')) {
        return 'US-Kajabi Gurus';
      }
      if (tags.includes('@affiliate')) {
        return 'Affiliate';
      }
      if (tags.includes('@cc360igdm') || tags.includes('@instagram')) {
        return 'Instagram';
      }
      return tags[0] || 'NA';
    }

    let chartInstance = null;

    async function fetchSalesData() {
      const fetchButton = document.getElementById('fetch-button');
      const fetchButtonText = document.getElementById('fetch-button-text');
      const fetchButtonSpinner = document.getElementById('fetch-button-spinner');
      const startDateInput = document.getElementById('start_date');
      const endDateInput = document.getElementById('end_date');

      fetchButton.disabled = true;
      startDateInput.disabled = true;
      endDateInput.disabled = true;
      fetchButtonText.textContent = 'Fetching...';
      fetchButtonSpinner.classList.remove('hidden');

      // Show loading placeholders and hide data sections
      document.getElementById('stats-cards-loading').classList.remove('hidden');
      document.getElementById('stats-cards').classList.add('hidden');
      document.getElementById('source-mrr-increase-loading').classList.remove('hidden');
      document.getElementById('source-mrr-increase').classList.add('hidden');
      document.getElementById('source-counts-loading').classList.remove('hidden');
      document.getElementById('source-counts').classList.add('hidden');
      document.getElementById('grouped-table-loading').classList.remove('hidden');
      document.getElementById('grouped-sales-table').classList.add('hidden');
      document.getElementById('detailed-table-loading').classList.remove('hidden');
      document.getElementById('detailed-sales-table').classList.add('hidden');
      document.getElementById('chart-loading').classList.remove('hidden');
      document.getElementById('chart-container').classList.add('hidden');

      console.log('Fetch Sales Data button clicked');

      try {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);

        if (isNaN(startDate) || isNaN(endDate)) {
          showNotification('Please select valid start and end dates.', 'warning');
          fetchButtonText.textContent = 'Fetch Sales Data';
          fetchButtonSpinner.classList.add('hidden');
          fetchButton.disabled = false;
          startDateInput.disabled = false;
          endDateInput.disabled = false;
          return;
        }

        console.log('Start Date:', startDate);
        console.log('End Date:', endDate);

        const response = await fetch('https://wse6p5xqvwvjqwjdzo5qphqkue0titsh.lambda-url.us-west-2.on.aws/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ start_date: startDate.toISOString().split('T')[0], end_date: endDate.toISOString().split('T')[0] })
        });

        if (!response.ok) {
          throw new Error(`Network response was not ok (${response.statusText})`);
        }

        const data = await response.json();
        console.log('Response Data:', data);

        const sourceCountsContainer = document.getElementById('source-counts');
        const sourceMRRIncreaseContainer = document.getElementById('source-mrr-increase');
        sourceCountsContainer.innerHTML = '';
        sourceMRRIncreaseContainer.innerHTML = '';

        let totalRevenue = 0;
        let totalSalesAmount = 0;
        let demoCompletedRevenue = 0;
        let demoCompletedSalesAmount = 0;
        let noDemoCompletedRevenue = 0;
        let noDemoCompletedSalesAmount = 0;

        const sourceCounts = {};
        const sourceMRRIncreases = {};

        // Combine rows with the same product names and calculate the average price if there are different prices
        const combinedData = {};
        data.forEach(item => {
          const productName = item["Product Name"];
          if (productName === "All Totals" || productName === "Demo Completed Totals" || productName === "No Demo Completed Totals") {
            return; // Skip these items
          }
          if (!combinedData[productName]) {
            combinedData[productName] = {
              "Product Name": productName,
              "Total Revenue": 0,
              "Sales Amount": 0,
              "Prices": []
            };
          }
          combinedData[productName]["Total Revenue"] += item["Total_Revenue"];
          combinedData[productName]["Sales Amount"] += item["Sales_Amount"];
          combinedData[productName]["Prices"].push(item["Price"]);

          // Update total revenue and sales amount
          totalRevenue += item["Total_Revenue"];
          totalSalesAmount += item["Sales_Amount"];

          // Check if demo was completed
          if (item["Demo Completed"] === "Yes") {
            demoCompletedRevenue += item["Total_Revenue"];
            demoCompletedSalesAmount += item["Sales_Amount"];
          } else {
            noDemoCompletedRevenue += item["Total_Revenue"];
            noDemoCompletedSalesAmount += item["Sales_Amount"];
          }
        });

        Object.values(combinedData).forEach(item => {
          item["Price"] = item["Prices"].reduce((a, b) => a + b, 0) / item["Prices"].length;
          delete item["Prices"];
        });

        groupedDataArray = Object.values(combinedData);
        groupedDataArray.sort((a, b) => b["Total Revenue"] - a["Total Revenue"]);
        groupedCurrentPage = 1;

        // Sort detailedDataArray rows by date, with the most recent at the top
        detailedDataArray = [];
        data.forEach(item => {
          if (item["Product Name"] !== "All Totals" && item["Product Name"] !== "Demo Completed Totals" && item["Product Name"] !== "No Demo Completed Totals") {
            item.Emails.forEach((email, index) => {
              detailedDataArray.push({
                email: email,
                productName: item["Product Name"],
                price: item["Price"],
                saleDate: new Date(item["Sale Dates"][index]),
                source: filterTags(item["Sources"][index].split(', '))
              });

              // Count sources, only the first occurrence
              if (!sourceCounts[email]) {
                sourceCounts[email] = filterTags(item["Sources"][index].split(', '));
              }

              // Calculate MRR increase from each source
              const source = filterTags(item["Sources"][index].split(', '));
              if (!sourceMRRIncreases[source]) {
                sourceMRRIncreases[source] = 0;
              }
              sourceMRRIncreases[source] += item["Price"];
            });
          }
        });

        detailedDataArray.sort((a, b) => b.saleDate - a.saleDate);
        detailedCurrentPage = 1;

        // Aggregate source counts
        const aggregatedSourceCounts = {};
        Object.values(sourceCounts).forEach(source => {
          if (aggregatedSourceCounts[source]) {
            aggregatedSourceCounts[source]++;
          } else {
            aggregatedSourceCounts[source] = 1;
          }
        });

        // Calculate percentages
        const totalSourceCount = Object.values(aggregatedSourceCounts).reduce((acc, count) => acc + count, 0);
        const sourcePercentages = {};
        Object.keys(aggregatedSourceCounts).forEach(source => {
          sourcePercentages[source] = ((aggregatedSourceCounts[source] / totalSourceCount) * 100).toFixed(2);
        });

        const workdays = calculateWorkdays(startDate, endDate);
        const avgDailyMRR = workdays > 0 ? totalRevenue / workdays : 0;
        const mrrTrajectory = avgDailyMRR * 22; // Assuming 22 workdays in a month

        document.getElementById('total-amount').textContent = formatCurrency(totalRevenue);
        document.getElementById('total-sales-amount').textContent = `Sales Amount: ${totalSalesAmount}`;
        document.getElementById('demo-completed-amount').textContent = formatCurrency(demoCompletedRevenue);
        document.getElementById('demo-completed-sales-amount').textContent = `Sales Amount: ${demoCompletedSalesAmount}`;
        document.getElementById('no-demo-completed-amount').textContent = formatCurrency(noDemoCompletedRevenue);
        document.getElementById('no-demo-completed-sales-amount').textContent = `Sales Amount: ${noDemoCompletedSalesAmount}`;
        document.getElementById('avg-daily-mrr').textContent = formatCurrency(avgDailyMRR);
        document.getElementById('mrr-trajectory').textContent = formatCurrency(mrrTrajectory);

        // Create source count cards
        Object.keys(sourcePercentages).forEach(source => {
          const card = document.createElement('div');
          card.classList.add('bg-gray-800', 'overflow-hidden', 'shadow', 'rounded-lg', 'px-4', 'py-5', 'sm:p-6');
          const sourceName = document.createElement('dt');
          sourceName.classList.add('text-sm', 'font-medium', 'text-gray-400', 'truncate');
          sourceName.textContent = source;
          const sourceCount = document.createElement('dd');
          sourceCount.classList.add('mt-1', 'text-3xl', 'font-semibold', 'text-white');
          sourceCount.textContent = `${sourcePercentages[source]}%`;
          const sourceTotal = document.createElement('dd');
          sourceTotal.classList.add('text-sm', 'text-gray-400');
          sourceTotal.textContent = `Total: ${aggregatedSourceCounts[source]}`;
          card.appendChild(sourceName);
          card.appendChild(sourceCount);
          card.appendChild(sourceTotal);
          sourceCountsContainer.appendChild(card);
        });

        // Create MRR increase cards
        Object.keys(sourceMRRIncreases).forEach(source => {
          const card = document.createElement('div');
          card.classList.add('bg-gray-800', 'overflow-hidden', 'shadow', 'rounded-lg', 'px-4', 'py-5', 'sm:p-6');
          const sourceName = document.createElement('dt');
          sourceName.classList.add('text-sm', 'font-medium', 'text-gray-400', 'truncate');
          sourceName.textContent = source;
          const sourceMRR = document.createElement('dd');
          sourceMRR.classList.add('mt-1', 'text-3xl', 'font-semibold', 'text-white');
          sourceMRR.textContent = formatCurrency(sourceMRRIncreases[source]);
          card.appendChild(sourceName);
          card.appendChild(sourceMRR);
          sourceMRRIncreaseContainer.appendChild(card);
        });

        // Render the pie chart
        const ctx = document.getElementById('sourcePieChart').getContext('2d');
        if (chartInstance) {
          chartInstance.destroy();
        }
        chartInstance = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: Object.keys(sourcePercentages),
            datasets: [{
              data: Object.values(aggregatedSourceCounts),
              backgroundColor: [
                'rgba(255, 99, 132, 0.6)',
                'rgba(54, 162, 235, 0.6)',
                'rgba(255, 206, 86, 0.6)',
                'rgba(75, 192, 192, 0.6)',
                'rgba(153, 102, 255, 0.6)',
                'rgba(255, 159, 64, 0.6)',
                'rgba(199, 199, 199, 0.6)',
                'rgba(83, 102, 255, 0.6)',
                'rgba(255, 159, 255, 0.6)',
                'rgba(255, 206, 86, 0.6)',
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'top',
                labels: {
                  color: 'white'
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.raw || 0;
                    return `${label}: ${value} (${sourcePercentages[label]}%)`;
                  }
                },
                intersect: false,
                mode: 'index'
              },
              zoom: {
                zoom: {
                  enabled: true,
                  mode: 'xy',
                  speed: 0.1,
                },
                pan: {
                  enabled: true,
                  mode: 'xy',
                  speed: 10,
                },
              },
            }
          }
        });

        // Hide loading placeholders and show data sections
        document.getElementById('stats-cards-loading').classList.add('hidden');
        document.getElementById('stats-cards').classList.remove('hidden');
        document.getElementById('source-mrr-increase-loading').classList.add('hidden');
        document.getElementById('source-mrr-increase').classList.remove('hidden');
        document.getElementById('source-counts-loading').classList.add('hidden');
        document.getElementById('source-counts').classList.remove('hidden');
        document.getElementById('grouped-table-loading').classList.add('hidden');
        document.getElementById('grouped-sales-table').classList.remove('hidden');
        document.getElementById('detailed-table-loading').classList.add('hidden');
        document.getElementById('detailed-sales-table').classList.remove('hidden');
        document.getElementById('chart-loading').classList.add('hidden');
        document.getElementById('chart-container').classList.remove('hidden');

        renderGroupedTable();
        renderDetailedTable();

        fetchButtonText.textContent = 'Fetch Sales Data';
        fetchButtonSpinner.classList.add('hidden');
        fetchButton.disabled = false;
        startDateInput.disabled = false;
        endDateInput.disabled = false;

        showNotification('Sales data fetched successfully.', 'success');

      } catch (error) {
        console.error('Error fetching sales data:', error);
        showNotification('An error occurred while fetching sales data. Please try again.', 'error');
        fetchButtonText.textContent = 'Fetch Sales Data';
        fetchButtonSpinner.classList.add('hidden');
        fetchButton.disabled = false;
        startDateInput.disabled = false;
        endDateInput.disabled = false;
      }
    }

    // Sorting and Filtering Functions for Grouped Table
    function renderGroupedTable() {
      const tbody = document.getElementById('grouped-table-body');
      tbody.innerHTML = '';
      groupedRowsPerPage = document.getElementById('grouped-rows-per-page').value;
      groupedRowsPerPage = groupedRowsPerPage === 'All' ? groupedDataArray.length : parseInt(groupedRowsPerPage);

      let dataToRender = [...groupedDataArray];

      // Apply search filter
      const searchValue = document.getElementById('grouped-search').value.toLowerCase().trim();
      if (searchValue !== '') {
        dataToRender = dataToRender.filter(item => item["Product Name"].toLowerCase().includes(searchValue));
      }

      // Update total entries
      document.getElementById('grouped-total-entries').textContent = dataToRender.length;

      // Sort data
      if (groupedSortColumn) {
        dataToRender.sort((a, b) => {
          let comparison = 0;
          if (a[groupedSortColumn] > b[groupedSortColumn]) {
            comparison = 1;
          } else if (a[groupedSortColumn] < b[groupedSortColumn]) {
            comparison = -1;
          }
          return groupedSortDirection === 'asc' ? comparison : -comparison;
        });
      }

      // Pagination
      const startIndex = (groupedCurrentPage - 1) * groupedRowsPerPage;
      const endIndex = startIndex + groupedRowsPerPage;
      const pageData = dataToRender.slice(startIndex, endIndex);

      pageData.forEach(item => {
        const row = document.createElement('tr');
        ['Product Name', 'Price', 'Total Revenue', 'Sales Amount'].forEach(key => {
          const td = document.createElement('td');
          td.classList.add('px-6', 'py-4', 'whitespace-nowrap');
          if (key === 'Product Name') {
            const badge = document.createElement('span');
            badge.classList.add('inline-flex', 'items-center', 'px-3', 'py-0.5', 'rounded-full', 'text-sm', 'font-medium');
            badge.classList.add(...getBadgeClass(item[key]).split(' '));
            badge.textContent = item[key];
            td.appendChild(badge);
          } else {
            td.textContent = key === 'Total Revenue' || key === 'Price' ? formatCurrency(item[key]) : item[key];
            td.classList.add('text-gray-300');
          }
          row.appendChild(td);
        });
        tbody.appendChild(row);
      });

      // Update pagination info
      document.getElementById('grouped-start-index').textContent = dataToRender.length === 0 ? 0 : startIndex + 1;
      document.getElementById('grouped-end-index').textContent = endIndex > dataToRender.length ? dataToRender.length : endIndex;
    }

    function sortGroupedTable(column) {
      if (groupedSortColumn === column) {
        groupedSortDirection = groupedSortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        groupedSortColumn = column;
        groupedSortDirection = 'asc';
      }
      // Update sort icons
      ['Product Name', 'Price', 'Total Revenue', 'Sales Amount'].forEach(col => {
        document.getElementById(`grouped-sort-icon-${col}`).textContent = '';
      });
      document.getElementById(`grouped-sort-icon-${column}`).textContent = groupedSortDirection === 'asc' ? ' ▲' : ' ▼';

      renderGroupedTable();
    }

    function filterGroupedTable() {
      groupedCurrentPage = 1;
      renderGroupedTable();
    }

    function nextGroupedPage() {
      groupedCurrentPage++;
      renderGroupedTable();
    }

    function previousGroupedPage() {
      if (groupedCurrentPage > 1) {
        groupedCurrentPage--;
        renderGroupedTable();
      }
    }

    // Sorting and Filtering Functions for Detailed Table
    function renderDetailedTable() {
      const tbody = document.getElementById('detailed-table-body');
      tbody.innerHTML = '';
      detailedRowsPerPage = document.getElementById('detailed-rows-per-page').value;
      detailedRowsPerPage = detailedRowsPerPage === 'All' ? detailedDataArray.length : parseInt(detailedRowsPerPage);

      let dataToRender = [...detailedDataArray];

      // Apply search filter
      const searchValue = document.getElementById('detailed-search').value.toLowerCase().trim();
      if (searchValue !== '') {
        dataToRender = dataToRender.filter(item =>
          item.email.toLowerCase().includes(searchValue) ||
          item.productName.toLowerCase().includes(searchValue) ||
          item.source.toLowerCase().includes(searchValue)
        );
      }

      // Update total entries
      document.getElementById('detailed-total-entries').textContent = dataToRender.length;

      // Sort data
      if (detailedSortColumn) {
        dataToRender.sort((a, b) => {
          let comparison = 0;
          if (a[detailedSortColumn] > b[detailedSortColumn]) {
            comparison = 1;
          } else if (a[detailedSortColumn] < b[detailedSortColumn]) {
            comparison = -1;
          }
          return detailedSortDirection === 'asc' ? comparison : -comparison;
        });
      }

      // Pagination
      const startIndex = (detailedCurrentPage - 1) * detailedRowsPerPage;
      const endIndex = startIndex + detailedRowsPerPage;
      const pageData = dataToRender.slice(startIndex, endIndex);

      pageData.forEach(item => {
        const row = document.createElement('tr');
        const emailTd = document.createElement('td');
        emailTd.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-sm', 'text-gray-300');
        emailTd.innerHTML = `${item.email} <span class="text-xs text-gray-400">${formatDate(item.saleDate)}</span>`;
        row.appendChild(emailTd);

        const productNameTd = document.createElement('td');
        productNameTd.classList.add('px-6', 'py-4', 'whitespace-nowrap');
        const badge = document.createElement('span');
        badge.classList.add('inline-flex', 'items-center', 'px-3', 'py-0.5', 'rounded-full', 'text-sm', 'font-medium');
        badge.classList.add(...getBadgeClass(item.productName).split(' '));
        badge.textContent = item.productName;
        productNameTd.appendChild(badge);
        row.appendChild(productNameTd);

        const priceTd = document.createElement('td');
        priceTd.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-sm', 'text-gray-300');
        priceTd.textContent = formatCurrency(item.price);
        row.appendChild(priceTd);

        const sourceTd = document.createElement('td');
        sourceTd.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-sm', 'text-gray-300');
        sourceTd.textContent = item.source;
        row.appendChild(sourceTd);

        tbody.appendChild(row);
      });

      // Update pagination info
      document.getElementById('detailed-start-index').textContent = dataToRender.length === 0 ? 0 : startIndex + 1;
      document.getElementById('detailed-end-index').textContent = endIndex > dataToRender.length ? dataToRender.length : endIndex;
    }

    function sortDetailedTable(column) {
      if (detailedSortColumn === column) {
        detailedSortDirection = detailedSortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        detailedSortColumn = column;
        detailedSortDirection = 'asc';
      }
      // Update sort icons
      ['Email', 'Product Name', 'Price', 'Source'].forEach(col => {
        document.getElementById(`detailed-sort-icon-${col}`).textContent = '';
      });
      document.getElementById(`detailed-sort-icon-${column}`).textContent = detailedSortDirection === 'asc' ? ' ▲' : ' ▼';

      renderDetailedTable();
    }

    function filterDetailedTable() {
      detailedCurrentPage = 1;
      renderDetailedTable();
    }

    function nextDetailedPage() {
      detailedCurrentPage++;
      renderDetailedTable();
    }

    function previousDetailedPage() {
      if (detailedCurrentPage > 1) {
        detailedCurrentPage--;
        renderDetailedTable();
      }
    }

  </script>
</body>
</html>