<!DOCTYPE html>
<html>
<head>
    <title>Projects Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="p-10">
    <h1 class="text-3xl mb-2">Projects</h1>
    <div class="flex items-center mb-10">
        <input class="border p-2 rounded mr-4 flex-grow" type="text" placeholder="Search..." id="searchInput">
        <button class="border p-2 rounded" id="addButton" onclick="addNewProject()">Add New +</button>
    </div>
    <div class="grid grid-cols-3 gap-4" id="projectsContainer">
    </div>
    <script>
        const addNewProject = () => {
            const uId = new URLSearchParams(window.location.search).get('uId') || '1'; // Set to '1' as default if uId is not present in the URL
            window.location.href = `create-new-project.html?uId=${uId}`;
        }

        const displayProjects = (projects) => {
            const projectsContainer = document.getElementById('projectsContainer');
            projectsContainer.innerHTML = '';
            projects.forEach(project => {
                const projectHTML = `
                    <a class="project-link" href="viewProject.html?projectId=${project.projectId}">
                        <div class="border p-4 rounded">
                            <div class="flex items-center">
                                <img class="project-icon" src="${project.projectIcon || 'icon.png'}" alt="icon" class="w-6 h-6">
                                <h2 class="ml-4">${project.projectName}</h2>
                            </div>
                            <p class="text-left text-sm">${project.lastUpdated}</p>
                        </div>
                    </a>
                `;
                projectsContainer.innerHTML += projectHTML;
            });
        }

        window.onload = () => {
            let uId = new URLSearchParams(window.location.search).get('uId');
            uId = uId.split('?')[0];
            console.log(uId); // Console log the uId

            axios.post('https://tvbuvokazmaktj5vxl3czencoy0twlmp.lambda-url.us-west-2.on.aws/', {
                uId: uId,
                requestType: 'FETCH_ALL_PROJECTS'
            })
            .then(function (response) {
                console.log(response);
                const projectList = response.data.map(project => ({
                    ...project,
                    lastUpdated: new Date(project.lastUpdated * 1000).toLocaleString(), // Convert Unix timestamp to readable date-time
                    githubUsername: project.githubUserName
                }));
                displayProjects(projectList);
            })
            .catch(function (error) {
                console.log(error);
            });

            document.getElementById('searchInput').addEventListener('input', (e) => {
                const filteredProjects = projectList.filter(project => 
                    project.projectName.toLowerCase().includes(e.target.value.toLowerCase())
                );
                displayProjects(filteredProjects);
            });
        }
    </script>
</body>
</html>
