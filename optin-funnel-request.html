<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POST Request Example</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.0/dist/tailwind.min.css" rel="stylesheet">
  <style>
    #autocompleteList {
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      overflow: auto;
      max-height: 150px;
      position: absolute;
      background-color: #fff;
    }

    #autocompleteList div {
      padding: 10px;
      cursor: pointer;
    }

    #autocompleteList div:hover {
      background-color: #e9e9e9;
    }
  </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded shadow-md w-full max-w-md">
    <h1 class="text-2xl font-bold mb-6">Make a POST Request</h1>

    <div class="mb-4 relative">
      <label for="locationSearch" class="block text-sm font-medium text-gray-700">Search Location</label>
      <input type="text" id="locationSearch" name="locationSearch" class="mt-1 p-2 border border-gray-300 rounded w-full" required>
      <div id="autocompleteList" class="hidden"></div>
    </div>

    <form id="postForm" class="space-y-4">
      <div>
        <label for="locationId" class="block text-sm font-medium text-gray-700">Location ID</label>
        <input type="text" id="locationId" name="locationId" class="mt-1 p-2 border border-gray-300 rounded w-full" required readonly>
      </div>

      <div>
        <label for="courseDescription" class="block text-sm font-medium text-gray-700">Course Description</label>
        <input type="text" id="courseDescription" name="courseDescription" class="mt-1 p-2 border border-gray-300 rounded w-full" required>
      </div>

      <div>
        <label for="funnelName" class="block text-sm font-medium text-gray-700">Funnel Name</label>
        <input type="text" id="funnelName" name="funnelName" class="mt-1 p-2 border border-gray-300 rounded w-full" required>
      </div>

      <button type="submit" id="submitButton" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Submit</button>
    </form>

    <div id="responseContainer" class="mt-6 hidden bg-gray-100 p-4 rounded"></div>
    <div id="breadcrumbs" class="mt-4 hidden space-x-2"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async function () {
      const url = 'https://fav6m76uqbgrm2ul5ay2e2x2xa0lwfbq.lambda-url.us-west-2.on.aws/';
      let locations = [];

      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          locations = await response.json();
        } else {
          console.error('Failed to fetch locations');
        }
      } catch (error) {
        console.error('Error:', error);
      }

      const locationSearch = document.getElementById('locationSearch');
      const autocompleteList = document.getElementById('autocompleteList');
      const locationIdInput = document.getElementById('locationId');

      locationSearch.addEventListener('input', function () {
        const value = this.value;
        autocompleteList.innerHTML = '';
        if (value) {
          const filteredLocations = locations.filter(location =>
            location.location_name.toLowerCase().includes(value.toLowerCase())
          );

          filteredLocations.forEach(location => {
            const item = document.createElement('div');
            item.textContent = location.location_name;
            item.onclick = function () {
              locationSearch.value = location.location_name;
              locationIdInput.value = location.location_id;
              autocompleteList.innerHTML = '';
              autocompleteList.classList.add('hidden');
            };
            autocompleteList.appendChild(item);
          });

          autocompleteList.classList.remove('hidden');
        } else {
          autocompleteList.classList.add('hidden');
        }
      });

      document.getElementById('postForm').addEventListener('submit', async function (event) {
        event.preventDefault();

        const submitButton = document.getElementById('submitButton');
        const breadcrumbs = document.getElementById('breadcrumbs');
        const responseContainer = document.getElementById('responseContainer');

        submitButton.textContent = 'Submitting...';

        const postUrl = 'https://by3ruwm7wd6vpoqbgmefvhk6ny0rxhqb.lambda-url.us-west-2.on.aws/';
        const data = {
          locationId: document.getElementById('locationId').value,
          courseDescription: document.getElementById('courseDescription').value,
          funnelName: document.getElementById('funnelName').value
        };

        try {
          const response = await fetch(postUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
          });

          responseContainer.classList.remove('hidden');

          if (response.ok) {
            const jsonResponse = await response.json();
            responseContainer.textContent = JSON.stringify(jsonResponse, null, 4);
            responseContainer.classList.add('bg-green-100');
            breadcrumbs.innerHTML = '<span class="bg-green-500 text-white px-3 py-1 rounded">Success</span>';
          } else {
            const errorMessage = await response.text();
            responseContainer.textContent = `Error: ${response.status} - ${errorMessage}`;
            responseContainer.classList.add('bg-red-100');
            breadcrumbs.innerHTML = '<span class="bg-red-500 text-white px-3 py-1 rounded">Failed</span>';
          }
        } catch (error) {
          console.error('Error:', error);
          responseContainer.textContent = `Request Failed: ${error.message}`;
          responseContainer.classList.remove('hidden');
          responseContainer.classList.add('bg-red-100');
          breadcrumbs.innerHTML = '<span class="bg-red-500 text-white px-3 py-1 rounded">Failed</span>';
        } finally {
          submitButton.textContent = 'Submit';
          breadcrumbs.classList.remove('hidden');
        }
      });
    });
  </script>
</body>

</html>
