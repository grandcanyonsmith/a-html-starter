<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Lambda Function Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">AWS Lambda Function Viewer</h1>
        <div id="functionList" class="mt-4">
            <!-- Lambda functions will be displayed here -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Page loaded, fetching Lambda functions');
            const functionList = document.getElementById('functionList');
            functionList.innerHTML = '<p>Loading...</p>';

            try {
                const response = await fetch('https://j6uh5lxq4xjbm3k253olur2joy0bpebl.lambda-url.us-west-2.on.aws/');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                console.log('Lambda Functions:', data);

                functionList.innerHTML = '';
                data.forEach(func => {
                    const funcElement = document.createElement('div');
                    funcElement.className = 'bg-white p-4 rounded shadow mb-4';
                    
                    // Create a string to hold the formatted code files
                    let codeFilesContent = '';
                    for (const [fileName, fileContent] of Object.entries(func.CodeFiles)) {
                        codeFilesContent += `<h3 class="text-lg font-semibold">${fileName}</h3><pre class="whitespace-pre-wrap">${fileContent}</pre>`;
                    }

                    funcElement.innerHTML = `
                        <h2 class="text-xl font-bold cursor-pointer">${func.FunctionName}</h2>
                        <div class="hidden mt-2 p-4 bg-gray-100 rounded" id="code-${func.FunctionName}">
                            ${codeFilesContent}
                        </div>
                    `;
                    funcElement.querySelector('h2').addEventListener('click', () => {
                        const codeDiv = document.getElementById(`code-${func.FunctionName}`);
                        if (codeDiv.classList.contains('hidden')) {
                            codeDiv.classList.remove('hidden');
                            codeDiv.classList.add('block');
                        } else {
                            codeDiv.classList.remove('block');
                            codeDiv.classList.add('hidden');
                        }
                        console.log(`Toggled visibility for ${func.FunctionName}`);
                    });
                    functionList.appendChild(funcElement);
                });
            } catch (error) {
                console.error('Error fetching Lambda functions:', error);
                functionList.innerHTML = '<p class="text-red-500">Error fetching Lambda functions. Please try again later.</p>';
            }
        });
    </script>
</body>
</html>
