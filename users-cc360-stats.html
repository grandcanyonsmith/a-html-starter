
<!DOCTYPE html>

<html lang="en">



<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Users List</title>

    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</head>



<body>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8">

        <div class="flex flex-col sm:flex-row justify-between items-center py-4">

            <div class="w-full sm:w-auto mb-4 sm:mb-0">

                <label for="startDate" class="block text-sm font-medium text-gray-700">Start Date</label>

                <input type="date" id="startDate" name="startDate" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">

            </div>

            <div class="w-full sm:w-auto mb-4 sm:mb-0">

                <label for="endDate" class="block text-sm font-medium text-gray-700">End Date</label>

                <input type="date" id="endDate" name="endDate" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">

            </div>

            <button id="fetchData" class="w-full sm:w-auto ml-0 sm:ml-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">Fetch Data</button>

        </div>



        <div class="flex flex-col sm:flex-row justify-between items-center py-4 space-y-4 sm:space-y-0 sm:space-x-4">

            <div class="bg-white shadow rounded-lg p-4 w-full sm:w-1/3">

                <h3 class="text-lg leading-6 font-medium text-gray-900">MailGun Connected</h3>

                <div class="mt-2 flex items-baseline text-2xl font-semibold text-indigo-600" id="mailgunPercentage">0%</div>

                <div class="text-sm text-gray-500" id="mailgunCount">0 of 0</div>

            </div>

            <div class="bg-white shadow rounded-lg p-4 w-full sm:w-1/3">

                <h3 class="text-lg leading-6 font-medium text-gray-900">First Transaction Completed</h3>

                <div class="mt-2 flex items-baseline text-2xl font-semibold text-indigo-600" id="transactionPercentage">0%</div>

                <div class="text-sm text-gray-500" id="transactionCount">0 of 0</div>

            </div>
<div class="bg-white shadow rounded-lg p-4 w-full sm:w-1/3">
    <h3 class="text-lg leading-6 font-medium text-gray-900">Payment Processor Connected</h3>
    <div class="mt-2 flex items-baseline text-2xl font-semibold text-indigo-600" id="paymentProcessorPercentage">0%</div>
    <div class="text-sm text-gray-500" id="paymentProcessorCount">0 of 0</div>
</div>

            <div class="bg-white shadow rounded-lg p-4 w-full sm:w-1/3">

                <h3 class="text-lg leading-6 font-medium text-gray-900">Average Time to Revenue</h3>

                <div class="mt-2 flex items-baseline text-2xl font-semibold text-indigo-600" id="averageTimeToRevenue">0 days</div>

            </div>

        </div>



        <div class="flex items-center justify-between py-4">

            <div class="relative inline-block text-left">

                <div>

                    <button type="button" class="group inline-flex justify-center text-sm font-medium text-gray-700 hover:text-gray-900" id="sortMenuButton" aria-expanded="false" aria-haspopup="true">

                        Sort

                        <svg class="-mr-1 ml-1 h-5 w-5 flex-shrink-0 text-gray-400 group-hover:text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">

                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />

                        </svg>

                    </button>

                </div>

                <div class="absolute left-0 z-10 mt-2 w-40 origin-top-left rounded-md bg-white shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="sortMenuButton" tabindex="-1" style="display: none;">

                    <div class="py-1" role="none">

                        <a href="#" class="block px-4 py-2 text-sm font-medium text-gray-900" role="menuitem" tabindex="-1" id="sortIncomeAllTime">All Time Revenue</a>

                        <a href="#" class="block px-4 py-2 text-sm font-medium text-gray-900" role="menuitem" tabindex="-1" id="sortTimestamp">Timestamp</a>

                    </div>

                </div>

            </div>

            <button type="button" class="inline-block text-sm font-medium text-gray-700 hover:text-gray-900" id="filterButton">Filters</button>

        </div>



        <div class="relative z-40 sm:hidden" role="dialog" id="filterPanel" aria-modal="true" style="display: none;">

            <div class="fixed inset-0 bg-black bg-opacity-25"></div>

            <div class="fixed inset-0 z-40 flex">

                <div class="relative ml-auto flex h-full w-full max-w-xs flex-col overflow-y-auto bg-white py-4 pb-6 shadow-xl">

                    <div class="flex items-center justify-between px-4">

                        <h2 class="text-lg font-medium text-gray-900">Filters</h2>

                        <button type="button" class="-mr-2 flex h-10 w-10 items-center justify-center rounded-md bg-white p-2 text-gray-400 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="closeFilterPanel">

                            <span class="sr-only">Close menu</span>

                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">

                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />

                            </svg>

                        </button>

                    </div>

                    <form class="mt-4">

                        <div class="border-t border-gray-200 px-4 py-6">

                            <h3 class="-mx-2 -my-3 flow-root">

                                <button type="button" class="flex w-full items-center justify-between bg-white px-2 py-3 text-sm text-gray-400" aria-controls="filter-section-0" aria-expanded="false">

                                    <span class="font-medium text-gray-900">Calendar</span>

                                    <span class="ml-6 flex items-center">

                                        <svg class="rotate-0 h-5 w-5 transform" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">

                                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />

                                        </svg>

                                    </span>

                                </button>

                            </h3>

                            <div class="pt-6" id="filter-section-0">

                                <div class="space-y-6">

                                    <div class="flex items-center">

                                        <input id="filterCalendarAll" name="filterCalendar" value="all" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                                        <label for="filterCalendarAll" class="ml-3 text-sm text-gray-500">All</label>

                                    </div>

                                    <div class="flex items-center">

                                        <input id="filterCalendarTrue" name="filterCalendar" value="true" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                                        <label for="filterCalendarTrue" class="ml-3 text-sm text-gray-500">True</label>

                                    </div>

                                    <div class="flex items-center">

                                        <input id="filterCalendarFalse" name="filterCalendar" value="false" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                                        <label for="filterCalendarFalse" class="ml-3 text-sm text-gray-500">False</label>

                                    </div>

                                </div>

                            </div>

                        </div>

                        <div class="border-t border-gray-200 px-4 py-6">

                            <h3 class="-mx-2 -my-3 flow-root">

                                <button type="button" class="flex w-full items-center justify-between bg-white px-2 py-3 text-sm text-gray-400" aria-controls="filter-section-1" aria-expanded="false">

                                    <span class="font-medium text-gray-900">Product</span>

                                    <span class="ml-6 flex items-center">

                                        <svg class="rotate-0 h-5 w-5 transform" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">

                                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />

                                        </svg>

                                    </span>

                                </button>

                            </h3>

                            <div class="pt-6" id="filter-section-1">

                                <div class="space-y-6">

                                    <div class="flex items-center">

                                        <input id="filterProductAll" name="filterProduct" value="all" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                                        <label for="filterProductAll" class="ml-3 text-sm text-gray-500">All</label>

                                    </div>

                                    <div class="flex items-center">

                                        <input id="filterProductTrue" name="filterProduct" value="true" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                                        <label for="filterProductTrue" class="ml-3 text-sm text-gray-500">True</label>

                                    </div>

                                    <div class="flex items-center">

                                        <input id="filterProductFalse" name="filterProduct" value="false" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                                        <label for="filterProductFalse" class="ml-3 text-sm text-gray-500">False</label>

                                    </div>

                                </div>

                            </div>

                        </div>

                        <div class="border-t border-gray-200 px-4 py-6">

                            <h3 class="-mx-2 -my-3 flow-root">

                                <button type="button" class="flex w-full items-center justify-between bg-white px-2 py-3 text-sm text-gray-400" aria-controls="filter-section-2" aria-expanded="false">

                                    <span class="font-medium text-gray-900">First Transaction</span>

                                    <span class="ml-6 flex items-center">

                                        <svg class="rotate-0 h-5 w-5 transform" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">

                                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />

                                        </svg>

                                    </span>

                                </button>

                            </h3>

                            <div class="pt-6" id="filter-section-2">

                                <div class="space-y-6">

                                    <div class="flex items-center">

                                        <input id="filterFirstTransactionAll" name="filterFirstTransaction" value="all" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                                        <label for="filterFirstTransactionAll" class="ml-3 text-sm text-gray-500">All</label>

                                    </div>

                                    <div class="flex items-center">

                                        <input id="filterFirstTransactionTrue" name="filterFirstTransaction" value="true" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                                        <label for="filterFirstTransactionTrue" class="ml-3 text-sm text-gray-500">True</label>

                                    </div>

                                    <div class="flex items-center">

                                        <input id="filterFirstTransactionFalse" name="filterFirstTransaction" value="false" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                                        <label for="filterFirstTransactionFalse" class="ml-3 text-sm text-gray-500">False</label>

                                    </div>

                                </div>

                            </div>

                        </div>

                        <div class="border-t border-gray-200 px-4 py-6">

                            <h3 class="-mx-2 -my-3 flow-root">

                                <button type="button" class="flex w-full items-center justify-between bg-white px-2 py-3 text-sm text-gray-400" aria-controls="filter-section-3" aria-expanded="false">

                                    <span class="font-medium text-gray-900">Mailgun Connected</span>

                                    <span class="ml-6 flex items-center">

                                        <svg class="rotate-0 h-5 w-5 transform" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">

                                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />

                                        </svg>

                                    </span>

                                </button>

                            </h3>

                            <div class="pt-6" id="filter-section-3">

                                <div class="space-y-6">

                                    <div class="flex items-center">

                                        <input id="filterMailgunAll" name="filterMailgun" value="all" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                                        <label for="filterMailgunAll" class="ml-3 text-sm text-gray-500">All</label>

                                    </div>

                                    <div class="flex items-center">

                                        <input id="filterMailgunTrue" name="filterMailgun" value="true" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                                        <label for="filterMailgunTrue" class="ml-3 text-sm text-gray-500">True</label>

                                    </div>

                                    <div class="flex items-center">

                                        <input id="filterMailgunFalse" name="filterMailgun" value="false" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                                        <label for="filterMailgunFalse" class="ml-3 text-sm text-gray-500">False</label>

                                    </div>

                                </div>

                            </div>

                        </div>
<div class="border-t border-gray-200 px-4 py-6">

    <h3 class="-mx-2 -my-3 flow-root">

        <button type="button" class="flex w-full items-center justify-between bg-white px-2 py-3 text-sm text-gray-400" aria-controls="filter-section-4" aria-expanded="false">

            <span class="font-medium text-gray-900">Status</span>

            <span class="ml-6 flex items-center">

                <svg class="rotate-0 h-5 w-5 transform" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">

                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />

                </svg>

            </span>

        </button>

    </h3>

    <div class="pt-6" id="filter-section-4">

        <div class="space-y-6">

            <div class="flex items-center">

                <input id="filterStatusAll" name="filterStatus" value="all" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                <label for="filterStatusAll" class="ml-3 text-sm text-gray-500">All</label>

            </div>

            <div class="flex items-center">

                <input id="filterStatusActive" name="filterStatus" value="active" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                <label for="filterStatusActive" class="ml-3 text-sm text-gray-500">Active</label>

            </div>

            <div class="flex items-center">

                <input id="filterStatusTrialing" name="filterStatus" value="trialing" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                <label for="filterStatusTrialing" class="ml-3 text-sm text-gray-500">Trialing</label>

            </div>

            <div class="flex items-center">

                <input id="filterStatusPastDue" name="filterStatus" value="past_due" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                <label for="filterStatusPastDue" class="ml-3 text-sm text-gray-500">Past Due</label>

            </div>

            <div class="flex items-center">

                <input id="filterStatusCanceled" name="filterStatus" value="canceled" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                <label for="filterStatusCanceled" class="ml-3 text-sm text-gray-500">Canceled</label>

            </div>

            <div class="flex items-center">

                <input id="filterStatusUnknown" name="filterStatus" value="Unknown" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                <label for="filterStatusUnknown" class="ml-3 text-sm text-gray-500">Unknown</label>

            </div>

        </div>

    </div>

</div>
 <div class="border-t border-gray-200 px-4 py-6">

    <h3 class="-mx-2 -my-3 flow-root">

        <button type="button" class="flex w-full items-center justify-between bg-white px-2 py-3 text-sm text-gray-400" aria-controls="filter-section-5" aria-expanded="false">

            <span class="font-medium text-gray-900">Payment Processor Integration</span>

            <span class="ml-6 flex items-center">

                <svg class="rotate-0 h-5 w-5 transform" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">

                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />

                </svg>

            </span>

        </button>

    </h3>

    <div class="pt-6" id="filter-section-5">

        <div class="space-y-6">

            <div class="flex items-center">

                <input id="filterPaymentProcessorAll" name="filterPaymentProcessor" value="all" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>

                <label for="filterPaymentProcessorAll" class="ml-3 text-sm text-gray-500">All</label>

            </div>

            <div class="flex items-center">

                <input id="filterPaymentProcessorTrue" name="filterPaymentProcessor" value="True" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                <label for="filterPaymentProcessorTrue" class="ml-3 text-sm text-gray-500">True</label>

            </div>

            <div class="flex items-center">

                <input id="filterPaymentProcessorFalse" name="filterPaymentProcessor" value="False" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">

                <label for="filterPaymentProcessorFalse" class="ml-3 text-sm text-gray-500">False</label>

            </div>

        </div>

    </div>

</div>

                    </form>

                </div>

            </div>

        </div>



        <div class="mt-8 flow-root">

            <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">

                <div class="inline-block min-w-full py-2 align-middle">

                    <table class="min-w-full border-separate border-spacing-0">

<thead>

    <tr>

        <!-- Existing column headers -->

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter sm:pl-6 lg:pl-8">Location Name</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter cursor-pointer" id="sortIncomeAllTime">All Time $</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter cursor-pointer hidden sm:table-cell" id="sortIncome90Days">90D $</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter cursor-pointer hidden sm:table-cell" id="sortIncome30Days">30D $</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter cursor-pointer hidden sm:table-cell" id="sortIncome7Days">7D $</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter">Calendars</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter">Products</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter">Relative Created Time</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter">Relative Time to Revenue</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter cursor-pointer" id="sortFirstTransaction">First Transaction</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter">Mailgun Connected</th>

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter">Payment Processor</th> <!-- New column header -->

        <th scope="col" class="sticky top-0 z-10 border-b border-gray-300 bg-white bg-opacity-75 px-3 py-3.5 text-left text-sm font-semibold text-gray-900 backdrop-blur backdrop-filter">Status</th>

    </tr>

</thead>

                        <tbody id="usersTable">

                            <!-- Users data will be inserted here -->

                        </tbody>

                    </table>

                </div>

            </div>

        </div>

    </div>



    <script>

let users = [];

let sortField = null;

let sortDirection = 1; // 1: ascending, -1: descending



document.getElementById('fetchData').addEventListener('click', function () {

    const startDate = document.getElementById('startDate').value;

    const endDate = document.getElementById('endDate').value;



    if (!startDate || !endDate) {

        alert('Please select both start and end dates.');

        return;

    }



    axios.post('https://rozduvvh2or5rxgucec3rfdp5e0hupbk.lambda-url.us-west-2.on.aws/', {

        startDate: startDate,

        endDate: endDate

    }, {

        headers: {

            'Content-Type': 'application/json'

        }

    })

    .then(function (response) {

        users = response.data.map(user => ({

            ...user,

            mailgun_connected: user.mailgun_connected === "true" || user.mailgun_connected === true,

            has_had_first_transaction: user.income_all_time > 0 || user.has_had_first_transaction === "true" || user.has_had_first_transaction === true,

            payment_processor_integration: user.payment_processor_integration === "True" || user.payment_processor_integration === true // New field

        }));

        renderTable(users);

        updateCards(users);

    })

    .catch(function (error) {

        console.error('Error fetching users:', error);

    });

});



document.getElementById('filterStatusAll').addEventListener('change', function () {

    const isChecked = this.checked;

    document.querySelectorAll('input[name="filterStatus"]').forEach(checkbox => {

        checkbox.checked = isChecked;

    });

    renderTable(users);

    updateCards(getFilteredUsers(users)); // Update cards after changing status filters

});



document.querySelectorAll('input[name="filterStatus"]').forEach(element => {

    element.addEventListener('change', function () {

        if (!this.checked && this.value !== 'all') {

            document.getElementById('filterStatusAll').checked = false;

        }

        const allChecked = Array.from(document.querySelectorAll('input[name="filterStatus"]')).every(checkbox => checkbox.checked || checkbox.value === 'all');

        if (allChecked) {

            document.getElementById('filterStatusAll').checked = true;

        }

        renderTable(users);

        updateCards(getFilteredUsers(users)); // Update cards after changing status filters

    });

});



document.querySelectorAll('input[name="filterCalendar"], input[name="filterProduct"], input[name="filterFirstTransaction"], input[name="filterMailgun"], input[name="filterStatus"]').forEach(element => {

    element.addEventListener('change', function () {

        renderTable(users);

        updateCards(users);

    });

});



document.querySelectorAll('[id^="sort"]').forEach(element => {

    element.addEventListener('click', function () {

        let field = this.id.replace('sort', '').replace(/([A-Z])/g, '_$1').toLowerCase().replace(/^_/, ''); // Convert camelCase to snake_case

        switch (field) {

            case 'income_30_days':

                field = 'last_thirty_day_income';

                break;

            case 'income_90_days':

                field = 'last_ninety_day_income';

                break;

            case 'income_7_days':

                field = 'last_seven_day_income';

                break;

            case 'income_all_time':

                field = 'income_all_time';

                break;

        }



        if (sortField === field) {

            sortDirection *= -1; // Toggle the direction

        } else {

            sortField = field;

            sortDirection = -1; // Default to descending for all fields initially

        }



        users.sort((a, b) => {

            let valA = parseFloat(a[field]);

            let valB = parseFloat(b[field]);



            if (isNaN(valA) || isNaN(valB)) {

                return 0; // Fallback for non-numeric or missing data

            } else {

                return (valA < valB ? -1 : 1) * sortDirection; // Numeric sorting

            }

        });



        renderTable(users);

    });

});



document.getElementById('filterButton').addEventListener('click', function () {

    document.getElementById('filterPanel').style.display = 'block';

});



document.getElementById('closeFilterPanel').addEventListener('click', function () {

    document.getElementById('filterPanel').style.display = 'none';

    const filteredUsers = getFilteredUsers(users);

    updateCards(filteredUsers);

});



function formatAccountStatus(status) {

    switch (status) {

        case 'active':

            return `<span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">Active</span>`;

        case 'trialing':

            return `<span class="inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-600/20">Trialing</span>`;

        case 'past_due':

            return `<span class="inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-700 ring-1 ring-inset ring-yellow-600/20">Past Due</span>`;

        case 'canceled':

            return `<span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/20">Canceled</span>`;

        default:

            return `<span class="inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-700 ring-1 ring-inset ring-gray-600/20">Unknown</span>`;

    }

}



  document.querySelectorAll('input[name="filterPaymentProcessor"]').forEach(element => {

    element.addEventListener('change', function () {

        renderTable(users);

        updateCards(users);

    });

});



function renderTable(users) {

    const tableBody = document.getElementById('usersTable');

    tableBody.innerHTML = ''; // Clear existing rows



    const filterCalendar = document.querySelector('input[name="filterCalendar"]:checked').value;

    const filterProduct = document.querySelector('input[name="filterProduct"]:checked').value;

    const filterFirstTransaction = document.querySelector('input[name="filterFirstTransaction"]:checked').value;

    const filterMailgun = document.querySelector('input[name="filterMailgun"]:checked').value;

    const filterPaymentProcessor = document.querySelector('input[name="filterPaymentProcessor"]:checked').value;



    const selectedStatuses = Array.from(document.querySelectorAll('input[name="filterStatus"]:checked')).map(checkbox => checkbox.value);



    const filteredUsers = users.filter(user => {

        const statusMatch = selectedStatuses.includes('all') || selectedStatuses.includes(user.account_status);

        return (filterCalendar === 'all' || (filterCalendar === 'true' && user.total_calendars > 0) || (filterCalendar === 'false' && user.total_calendars === 0)) &&

            (filterProduct === 'all' || (filterProduct === 'true' && user.total_products > 0) || (filterProduct === 'false' && user.total_products === 0)) &&

            (filterFirstTransaction === 'all' || (filterFirstTransaction === 'true' && user.has_had_first_transaction) || (filterFirstTransaction === 'false' && !user.has_had_first_transaction)) &&

            (filterMailgun === 'all' || (filterMailgun === 'true' && user.mailgun_connected) || (filterMailgun === 'false' && !user.mailgun_connected)) &&

            (filterPaymentProcessor === 'all' || (filterPaymentProcessor === 'True' && user.payment_processor_integration) || (filterPaymentProcessor === 'False' && !user.payment_processor_integration)) &&

            statusMatch;

    });



    filteredUsers.forEach(user => {

        const tr = document.createElement('tr');

        tr.innerHTML = `

            <td class="whitespace-nowrap border-b border-gray-200 py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6 lg:pl-8 text-xs sm:text-sm">

                <a href="https://app.coursecreator360.com/v2/location/${user.location_id}/dashboard" class="text-indigo-600 hover:text-indigo-900">

                    ${user.location_name}

                </a>

            </td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm font-medium text-gray-900">${formatIncome(user.income_all_time)}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm font-medium text-gray-900 hidden sm:table-cell">${formatIncome(user.last_ninety_day_income)}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm font-medium text-gray-900 hidden sm:table-cell">${formatIncome(user.last_thirty_day_income)}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm font-medium text-gray-900 hidden sm:table-cell">${formatIncome(user.last_seven_day_income)}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm text-gray-500">${formatHasCalendar(user.total_calendars)}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm text-gray-500">${formatHasProduct(user.total_products)}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm text-gray-500">${user.relative_created_time}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm text-gray-500">${user.relative_time_to_revenue || 'N/A'}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm text-gray-500">${formatFirstTransaction(user.has_had_first_transaction)}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm text-gray-500">${formatMailgunConnected(user.mailgun_connected)}</td>

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm text-gray-500">${formatPaymentProcessor(user.payment_processor_integration)}</td> <!-- New column -->

            <td class="whitespace-nowrap border-b border-gray-200 px-3 py-4 text-sm text-gray-500">${formatAccountStatus(user.account_status)}</td>

        `;

        tableBody.appendChild(tr);

    });



    // Update the cards with the filtered users

    updateCards(filteredUsers);

}



function getFilteredUsers(users) {

    const filterCalendar = document.querySelector('input[name="filterCalendar"]:checked').value;

    const filterProduct = document.querySelector('input[name="filterProduct"]:checked').value;

    const filterFirstTransaction = document.querySelector('input[name="filterFirstTransaction"]:checked').value;

    const filterMailgun = document.querySelector('input[name="filterMailgun"]:checked').value;

    const filterPaymentProcessor = document.querySelector('input[name="filterPaymentProcessor"]:checked').value;



    const selectedStatuses = Array.from(document.querySelectorAll('input[name="filterStatus"]:checked')).map(checkbox => checkbox.value);



    return users.filter(user => {

        const statusMatch = selectedStatuses.includes('all') || selectedStatuses.includes(user.account_status);

        return (filterCalendar === 'all' || (filterCalendar === 'true' && user.total_calendars > 0) || (filterCalendar === 'false' && user.total_calendars === 0)) &&

            (filterProduct === 'all' || (filterProduct === 'true' && user.total_products > 0) || (filterProduct === 'false' && user.total_products === 0)) &&

            (filterFirstTransaction === 'all' || (filterFirstTransaction === 'true' && user.has_had_first_transaction) || (filterFirstTransaction === 'false' && !user.has_had_first_transaction)) &&

            (filterMailgun === 'all' || (filterMailgun === 'true' && user.mailgun_connected) || (filterMailgun === 'false' && !user.mailgun_connected)) &&

            (filterPaymentProcessor === 'all' || (filterPaymentProcessor === 'True' && user.payment_processor_integration) || (filterPaymentProcessor === 'False' && !user.payment_processor_integration)) &&

            statusMatch;

    });

}



function formatMailgunConnected(isConnected) {

    if (isConnected) {

        return `<span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">Yes</span>`;

    } else {

        return `<span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/20">No</span>`;

    }

}



function formatIncome(income) {

    if (isNaN(parseFloat(income))) {

        return `<span class="text-gray-500">$0</span>`;

    } else if (parseFloat(income) === 0) {

        return `<span class="text-gray-500">$${parseFloat(income).toLocaleString()}</span>`;

    } else {

        return `<strong>$${parseFloat(income).toLocaleString()}</strong>`;

    }

}



function formatFirstTransaction(hasTransaction) {

    if (hasTransaction) {

        return `<span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">Yes</span>`;

    } else {

        return `<span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/20">No</span>`;

    }

}



function formatHasCalendar(totalCalendars) {

    if (totalCalendars > 0) {

        return `<span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">Has Calendar</span>`;

    } else {

        return `<span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/20">No Calendar</span>`;

    }

}



function formatHasProduct(totalProducts) {

    if (totalProducts > 0) {

        return `<span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">Has Product</span>`;

    } else {

        return `<span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/20">No Product</span>`;

    }

}



function formatPaymentProcessor(isIntegrated) {

    if (isIntegrated) {

        return `<span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">Yes</span>`;

    } else {

        return `<span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/20">No</span>`;

    }

}



function updateCards(filteredUsers) {
    const totalUsers = filteredUsers.length;

    const mailgunConnectedCount = filteredUsers.filter(user => user.mailgun_connected).length;
    const firstTransactionCount = filteredUsers.filter(user => user.has_had_first_transaction).length;
    const paymentProcessorCount = filteredUsers.filter(user => user.payment_processor_integration).length; // New line

    const mailgunPercentage = totalUsers ? (mailgunConnectedCount / totalUsers * 100).toFixed(2) : 0;
    const transactionPercentage = totalUsers ? (firstTransactionCount / totalUsers * 100).toFixed(2) : 0;
    const paymentProcessorPercentage = totalUsers ? (paymentProcessorCount / totalUsers * 100).toFixed(2) : 0; // New line

    document.getElementById('mailgunPercentage').innerText = `${mailgunPercentage}%`;
    document.getElementById('mailgunCount').innerText = `${mailgunConnectedCount} of ${totalUsers}`;

    document.getElementById('transactionPercentage').innerText = `${transactionPercentage}%`;
    document.getElementById('transactionCount').innerText = `${firstTransactionCount} of ${totalUsers}`;

    document.getElementById('paymentProcessorPercentage').innerText = `${paymentProcessorPercentage}%`; // New line
    document.getElementById('paymentProcessorCount').innerText = `${paymentProcessorCount} of ${totalUsers}`; // New line

    // Calculate average time to revenue
    const profitableUsers = filteredUsers.filter(user => user.has_had_first_transaction && user.time_to_become_profitable);
    const totalProfitableTime = profitableUsers.reduce((sum, user) => sum + user.time_to_become_profitable, 0);
    const averageTimeToRevenue = totalProfitableTime ? (totalProfitableTime / profitableUsers.length) / (1000 * 60 * 60 * 24) : 0; // Convert milliseconds to days

    document.getElementById('averageTimeToRevenue').innerText = `${averageTimeToRevenue.toFixed(2)} days`;
}




    </script>

</body>



</html>











